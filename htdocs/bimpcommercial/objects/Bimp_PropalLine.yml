extends: 
    module: bimpcommercial
    object_name: ObjectLine
   
abstract: 0

table: bimp_propal_line

parent_module: bimpcommercial
parent_object: Bimp_Propal

labels: 
    name: ligne de proposition commerciale
    name_plur: lignes de proposition commerciale
    is_female: 1
    
objects: 
    line: 
        relation: hasOne
        delete: 0
        instance: 
            dol_object: 
                module: comm/propal
                file: propal
                class: PropaleLigne
            id_object: 
                field_value: id_line
                
    dol_line: 
        instance: 
            bimp_object: 
                name: PropalDolLine
                
    linked_contrat_line: 
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: 
                module: bimpcontrat
                name: BCT_ContratLine
            id_object: 
                field_value: id_linked_contrat_line
            
fields: 
    # /!\ ATTENTION : en cas d'ajout de field, penser à gérer dans BS_SavPropalLine !
    
    abo_nb_units: 
        label: Nb unités dans l'abonnement
        type: float
        
    abo_fac_periodicity: 
        label: Périodicité de facturation
        type: int
        values: 
            array: periodicities
        default_value: 0
        depends_on: id_product,id_linked_contrat_line    
        
    abo_duration: 
        label: Durée totale abonnement (en mois)
        type: int
        default_value: 0
        depends_on: id_product,id_linked_contrat_line
        input: 
            type: custom
            content: 
                callback: renderAboDurationInput
        
    abo_fac_term: 
        label: Terme de facturation
        type: int
        default_value: 1
        values: 
            0: A terme échu
            1: A terme à échoir
        depends_on: id_product,id_linked_contrat_line
        
    abo_nb_renouv: 
        label: Nb renouvellements tacites
        type: int
        values: 
            array: nbRenouvellements
        default_value: 0
        depends_on: id_product,id_linked_contrat_line
        
#    abo_date_start: 
#        label: Date dé début de factuation
#        type: date
#        input: 
#            help: A renseigner uniquement pour une facturaton partielle de l'abonnement
            
    id_linked_contrat_line: 
        label: Abonnement lié
        type: id_object
        object: linked_contrat_line
        default_value: 0
        depends_on: id_product,abo_linked_line_other_ref
        input: 
            type: custom
            content: 
                callback: renderLinkedContratLineInput
            
forms: 
    default: 
        rows: 
            is_abo: 
                show: 1
                custom: 1
                hidden: 1
                label: Abonnement
                input_name: is_abonnement
                input: 
                    type: hidden
                depends_on: id_product
                value: 
                    callback: 
                        method: getValueByProduct
                        params: 
                            - is_abonnement
            abo_infos: 
                show: 1
                custom: 1
                label: Informations abonnement
                input_name: abo_infos
                input: 
                    type: custom
                    content: 
                        callback: renderAboInfos
                display_if: 
                    field_name: is_abonnement
                    show_values: 1
            abo_linked_line_other_ref: 
                show: 1
                custom: 1
                label: Lier à un abonnement d'une ref différente
                input_name: abo_linked_line_other_ref
                data_type: bool
                input:
                    type: toggle
                value:
                    callback: isAboLinkedToOtherRef
                edit:
                    callback: 
                        method: isFieldEditable
                        params: 
                            - abo_linked_line_other_ref
                display_if: 
                    field_name: is_abonnement
                    show_values: 1
            id_linked_contrat_line: 
                show: 1
                field: id_linked_contrat_line
                label: Ajouter les unités à un abonnement en cours
                display_if: 
                    field_name: is_abonnement
                    show_values: 1
            abo_linked_contrat_line_infos: 
                show: 1
                custom: 1
                input_name: abo_linked_contrat_line_infos
                label: Infos abonnement en cours
                input: 
                    type: custom
                    content: 
                        callback: displayLinkedContratLineInfos
                display_if: 
                    fields_names: is_abonnement,id_linked_contrat_line
                    is_abonnement: 
                        show_values: 1
                    id_linked_contrat_line: 
                        hide_values: 0
                depends_on: id_linked_contrat_line
            abo_fac_periodicity: 
                show: 1
                field: abo_fac_periodicity
                display_if: 
                    fields_names: is_abonnement,id_linked_contrat_line
                    is_abonnement: 
                        show_values: 1
                    id_linked_contrat_line: 
                        show_values: 0
            abo_duration: 
                show: 1
                field: abo_duration
                display_if: 
                    fields_names: is_abonnement,id_linked_contrat_line
                    is_abonnement: 
                        show_values: 1
                    id_linked_contrat_line: 
                        show_values: 0
            abo_date_from: 
                show: 1
                custom: 1
                label: Date d'ouverture prévue
                input_name: abo_date_from
                data_type: date
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - abo_date_from
                display_if: 
                    field_name: is_abonnement
                    show_values: 1
            abo_qty: 
                show: 1
                custom: 1
                label: Quantité
                input_name: abo_nb_units
                input: 
                   type: custom
                   content: 
                       callback: renderAboQtyInput
                display_if: 
                    fields_names: is_abonnement,abo_fac_periodicity,abo_duration
                    is_abonnement: 
                        show_values: 1
                    abo_fac_periodicity: 
                        hide_values: 0
                    abo_duration: 
                        hide_values: 0
                depends_on: id_product
            abo_fac_prorata_infos: 
                show: 1
                custom: 1
                label: Infos prorata de facturation
                input_name: abo_fac_prorata_infos
                content: 
                    callback: displayAboFacInfos
                display_if: 
                    field_name: id_linked_contrat_line
                    hide_values: 0
                depends_on: id_product,id_linked_contrat_line,abo_date_from,abo_nb_units
            abo_fac_term: 
                show: 1
                field: abo_fac_term
                display_if: 
                    fields_names: is_abonnement,id_linked_contrat_line
                    is_abonnement: 
                        show_values: 1
                    id_linked_contrat_line: 
                        show_values: 0
            abo_nb_renouv:
                show: 1
                field: abo_nb_renouv
                display_if: 
                    fields_names: is_abonnement,id_linked_contrat_line
                    is_abonnement: 
                        show_values: 1            
                    id_linked_contrat_line: 
                        show_values: 0
            qty: 
                display_if: 
                    unextends: 1
                    fields_names: type,is_abonnement
                    type: 
                        show_values: 1,3
                    is_abonnement: 
                        hide_values: 1
            limited: 
                display_if: 
                    unextends: 1
                    fields_names: type,is_abonnement
                    type: 
                        show_values: 1,3
                    is_abonnement: 
                        hide_values: 1
    
    abonnement: 
        title: Paramètres abonnement
        rows: 
            is_abo: 
                custom: 1
                hidden: 1
                label: Abonnement
                input_name: is_abonnement
                input: 
                    type: hidden
                value: 
                    callback: 
                        method: getValueByProduct
                        params: 
                            - is_abonnement
            abo_infos: 
                custom: 1
                label: Informations abonnement
                input_name: abo_infos
                input: 
                    type: custom
                    content: 
                        callback: renderAboInfos
            abo_linked_line_other_ref:
                custom: 1
                label: Lier à un abonnement d'une ref différente
                input_name: abo_linked_line_other_ref
                data_type: bool
                input:
                    type: toggle
                value:
                    callback: isAboLinkedToOtherRef
                edit:
                    callback: 
                        method: isFieldEditable
                        params: 
                            - abo_linked_line_other_ref
            id_linked_contrat_line: 
                show: 1
                field: id_linked_contrat_line
                label: Ajouter les unités à un abonnement en cours
            abo_linked_contrat_line_infos: 
                custom: 1
                input_name: abo_linked_contrat_line_infos
                label: Infos abonnement en cours
                input: 
                    type: custom
                    content: 
                        callback: displayLinkedContratLineInfos
                display_if: 
                    field_name: id_linked_contrat_line
                    hide_values: 0
                depends_on: id_linked_contrat_line
            abo_fac_periodicity: 
                field: abo_fac_periodicity
                display_if: 
                    field_name: id_linked_contrat_line
                    show_values: 0
            abo_duration: 
                field: abo_duration
                display_if: 
                    field_name: id_linked_contrat_line
                    show_values: 0
            abo_qty: 
                custom: 1
                label: Quantité
                input_name: abo_nb_units
                input: 
                   type: custom
                   content: 
                       callback: renderAboQtyInput
                display_if: 
                    fields_names: abo_fac_periodicity,abo_duration
                    abo_fac_periodicity: 
                        hide_values: 0
                    abo_duration: 
                        hide_values: 0
            abo_nb_renouv:
                field: abo_nb_renouv
                display_if: 
                    fields_names: is_abonnement,id_linked_contrat_line
                    is_abonnement: 
                        show_values: 1            
                    id_linked_contrat_line: 
                        show_values: 0
            qty:
                custom: 1
                hidden: 1
                label: Quantité
                value: 
                    prop: qty
                input_name: qty 
                input: 
                    type: hidden
                
            date_from: 
                custom: 1
                label: Date d'ouverture prévue
                input_name: date_from
                data_type: date
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - date_from
                            
            abo_fac_prorata_infos: 
                custom: 1
                label: Infos prorata de facturation
                input_name: abo_fac_prorata_infos
                content: 
                    callback: displayAboFacInfos
                display_if: 
                    field_name: id_linked_contrat_line
                    hide_values: 0
                depends_on: id_linked_contrat_line,date_from,abo_nb_units
                            
            abo_fac_term:
                field: abo_fac_term
                display_if: 
                    field_name: id_linked_contrat_line
                    show_values: 0
            
lists: 
    default: 
        objects_change_reload: ObjectLineRemise,RemiseGlobale,ObjectLineRemiseArriere,Bimp_Propal
