table: bc_vente
icon: fas_money-check-alt

labels: 
    name: vente
    is_female: 1
    
objects: 
    client_contact:
        extends: contact
        instance:
            id_object: 
                field_value: id_client_contact
            
    articles: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BC_VenteArticle
            
    paiements:
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BC_VentePaiement
            
    remises: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BC_VenteRemise
            
    returns: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BC_VenteReturn
            
    facture: 
        instance: 
            bimp_object: unset
            dol_object: 
                module: compta/facture
                file: facture
        cards: 
            default: 
                type: facture_card
                
    avoir:
        extends: facture
        instance: 
            id_object: 
                field_value: id_avoir
                
    discount: 
        instance: 
            dol_object: 
                module: core
                file: discount
                class: DiscountAbsolute
                
    user_resp: 
        extends: user
        instance: 
            id_object: 
                field_value: id_user_resp
                
associations: 
    discounts: 
        object: discount
        label: Avoirs client
        display: 
            default: 
                type: callback
        input: 
            type: select
            options: 
                array: availableCustomerDiscounts
                
fields:
    status: 
        label: Statut
        type: int
        values: 
            array: states
        default_value: 1
        
    total_ttc: 
        label: Total TTC
        type: money
        default_value: 0
        
    total_ht: 
        label: Total HT
        type: money
        default_value: 0
        
    id_caisse: 
        label: Caisse
        type: id_object
        object: caisse
        required: 1
        searchable: 0
        
    id_caisse_session:
        label: Session de caisse
        type: id_object
        object: caisse_session
        required: 1
        
    id_entrepot: 
        label: Centre
        type: id_object
        object: entrepot
        input: 
            type: search_entrepot
        required: 1
        
    id_client:
        label: Client
        type: id_object
        object: client
        input: 
            type: search_societe
            societe_type: customer
        display: 
            default:
                type: nom
            nom_url: 
                type: nom_url
                modal_view: client
                
    id_client_contact:
        label: Contact
        type: id_object
        object: client_contact
        values: 
            array: client_contacts
        display: 
            default:
                type: nom_url
        display_if:
            field_name: id_client
            hide_values: 0,
        depends_on: id_client
        
    id_cond_reglement:
        label: Condition de réglement
        type: int
        values: 
            array: cond_reglements
        default_value: 
            bimpcore_conf: bimpcaisse_id_cond_reglement_default
            
    id_facture: 
        label: Facture
        type: id_object
        object: facture
        display: 
            default: 
                type: nom_url
        input: 
            type: hidden
        default_value: 0
            
    id_avoir: 
        label: Avoir
        type: id_object
        object: avoir
        display: 
            default: 
                type: nom_url
        input: 
            type: hidden        
        default_value: 0
        
    id_user_resp: 
        label: Commercial
        type: id_object
        object: user_resp
        input: 
            type: search_user
        
    vente_ht: 
        label: Vente au prix hors-taxes
        type: bool
        default_value: 0
    note_plus: 
        label: Note
        
fields_tables: 
    infos: 
        title: Informations
        icon: info-circle
        rows: 
            - field: status
            - field: id_entrepot
              display: nom
            - field: id_caisse
              display: nom
            - field: id_user_resp
              display: nom_url
            - field: id_client
              display: nom_url
            - field: id_client_contact
              display: nom_url
            - field: id_cond_reglement
            - field: note_plus
            - field: id_facture
              display: card
              show: 
                  field_value: id_facture
            - field: id_avoir
              display: card
              show: 
                  field_value: id_avoir
            
    montants:
        title: Montants
        icon: euro
        rows: 
            - label: Nbre Articles
              value: 
                  callback: displayNbArticles
              label: Total produits hors remises
              value: 
                  callback: displayTotalWithoutRemises
            - label: Total remises
              value: 
                  callback: displayTotalRemises
            - label: Total Retours produits
              value: 
                  callback: displayTotalRetours
            - label: Total avoirs client utilisés
              value: 
                  callback: displayTotalDiscounts
            - label: Montant final TTC
              field: total_ttc   

views:
    default: 
        rows:
            - cols: 
                  - type: object_header
            - cols: 
                  - type: fields_table
                    col_lg: 6
                    col_md: 6
                    fields_table:
                        name: infos  
                  - type: fields_table
                    col_lg: 6
                    col_md: 6
                    fields_table:
                        name: montants  
            - cols: 
                - type: list
                  col_lg: 12
                  list: 
                      
                      name: default
                      children: articles
                      
            - cols: 
                - type: list
                  col_lg: 12
                  list: 
                      name: default
                      children: remises
                      
            - cols: 
                - type: list
                  col_lg: 12
                  list: 
                      title: Paiements
                      icon: euro
                      name: default
                      children: paiements
                      
            - cols: 
                - type: list
                  col_lg: 12
                  list: 
                      title: Retours produits
                      icon: reply
                      name: default
                      children: returns
    creation: 
        panel: 0
        no_reload: 1
        rows: 
            - cols: 
                - type: custom
                  custom:
                      callback: renderCreationViewHtml

lists_cols: 
    ref: 
        label: Ref.
        field: id
    status: 
        field: status
    date: 
        label: Date et heure
        field: date_create
    client: 
        field: id_client
        display: nom_url
    user_resp: 
        field: id_user_resp
        display: nom_url
    articles: 
        label: Nb articles
        value: 
            callback: displayNbArticles
    total_ttc: 
        field: total_ttc
    facture: 
        field: id_facture   
    avoir: 
        field: id_avoir
    centre: 
        field: id_entrepot
        display: nom
    caisse: 
        field: id_caisse
        display: nom

lists: 
    default: 
        configurable: 1
        sort_field: date_create
        sort_way: desc
        modal_view: default
        n: 10
        cols:
            ref: 
            status: 
            date: 
            client: 
            user_resp: 
            articles: 
            total_ttc: 
            facture: 
            avoir: 
        extra_btn:
            callback: getDefaultListExtraButtons
            
    full:
        configurable: 1
        checkboxes: 1
        item_checkbox: 
            callback: isDeletable
        bulk_actions: 
            - label: Supprimer les ventes sélectionnées
              icon: fas_trash-alt
              onclick: deleteSelectedObjects('list_id', $(this));
              btn_class: deleteSelectedObjects
        sort_field: date_create
        sort_way: desc
        modal_view: default
        delete_btn: 
            callback: isDeletable
        n: 10
        cols:
            ref: 
            centre: 
            caisse: 
            status: 
            date: 
            client: 
            user_resp:
            articles: 
            facture:  
            avoir: 
            total_ttc: 
        extra_btn:
            callback: getDocumentExtraButtons
            
forms: 
    client: 
        rows: 
            - field: id_client
              label: Choix du client