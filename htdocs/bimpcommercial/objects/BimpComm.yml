abstract: 1

primary: rowid

header_btn: 
    callback: getActionsButtons
    
header_list_name: default
header_edit_form: default

nom_url: 
    syntaxe: <ref>
    external_link: 1
    modal_view: full
    
objects:
    lines: 
        relation: hasMany
        delete: 0
        instance: 
            bimp_object: 
                module: bimpcommercial
                name: ObjectLine
        
    client: 
        instance: 
            id_object: 
                field_value: fk_soc
                
    contact: 
        instance: 
            id_object: unset
                
    files:
        relation: hasMany
        delete: 1
        instance:
            bimp_object:
                module: bimpcore
                name: BimpFile
        list: 
            filters:
                parent_module: bimpcommercial
                parent_object_name: BimpComm
                deleted: 0
        add_form: 
            name: upload
            values:
                fields: 
                    parent_module: bimpcommercial
                    parent_object_name: BimpComm
            
    user_author:
        extends: user
        instance: 
            id_object: 
                field_value: fk_user_author
            
    user_valid:
        extends: user
        instance: 
            id_object: 
                field_value: fk_user_valid
                
    entrepot: 
        instance: 
            id_object:
                field_value: entrepot
    
    bimp_entrepot: 
        instance: 
            id_object:
                field_value: entrepot
        
    rib_client: 
        instance: 
            bimp_object: 
                module: bimpcore
                name: Bimp_SocBankAccount
                
fields:
    entrepot: 
        label: Entrepôt
        dol_extra_field: 1
        type: id_object
        object: bimp_entrepot
        required: 
            callback: useEntrepot
        input: 
            type: search_entrepot
        default_value: 
            callback: getDefaultEntrepot
    libelle: 
        label: Libellé
        dol_extra_field: 1
#        required: 1
    ef_type: 
        label: Secteur (Canal de Vente)
        dol_extra_field: 1
        values: 
            array: secteurs
        default_value: 
            callback: getDefaultSecteur
        required: 
            callback: useEntrepot
    ref: 
        label: Référence
    fk_statut: 
        label: Statut
        type: int
        dol_prop: statut
        values: 
            array: status_list
        displays: 
            icon: 
                icon_only: 1
    fk_soc: 
        label: Client
        dol_prop: socid
        type: id_object
        object: client
        input: 
            card: default
        required: 1
        create_form: light
        edit_form: default
    ref_client: 
        label: Référence client
        user_edit: 1
    fk_cond_reglement: 
        label: Conditions de règlement
        dol_prop: cond_reglement_id
        type: id
        values: 
            array: condReglements
        input: 
            type: select_cond_reglement
        default_value: 
            callback: getCondReglementBySociete
        depends_on: fk_soc
        required: 1
    fk_mode_reglement: 
        label: Mode de règlement
        dol_prop: mode_reglement_id
        required : 1
        type: id
        values: 
            array: modeReglements
        input: 
            type: select_payment
            include_empty: 1
        default_value: 
            callback: getModeReglementBySociete
        depends_on: fk_soc
    fk_availability: 
        label: Délai de livraison
        dol_prop: availability_id
        type: int
        values: 
            array: availabilities
        input: 
            type: select_availability
        default_value: 0
    fk_input_reason: 
        label: Origine
        dol_prop: demand_reason_id
        type: int
        values: 
            array: demandReasons
        input: 
            type: select_input_reasons
        default_value: 0
    fk_user_author: 
        label: Créée par
        dol_prop: user_author_id
        type: id_object
        object: user_author
        input: 
            type: hidden
        search: 
            input: 
                type: search_user
        filter: 
            type: user
    fk_user_valid: 
        label: Validée par
        dol_prop: user_valid_id
        type: id_object
        object: user_valid
        input: 
            type: hidden
        filter: 
            input: 
                type: search_user
    date_valid:
        type: datetime
        label: Date Validation
    total: 
        label: Total TTC
        dol_prop: total_ttc
        type: money
    total_ttc: 
        label: Total TTC
        dol_prop: total_ttc
        type: money
    total_ht: 
        label: Total HT
        type: money
    tva: 
        label: Total TVA
        dol_prop: total_tva
        type: money    
    model_pdf: 
        label: Modèle de document par défaut
        dol_prop: modelpdf
        values: 
            array: modelsPdf
        sortable: 0
    note_private: 
        label: Note privée
        type: html
        sortable: 0
        user_edit: 1
    note_public: 
        label: Note publique
        type: html  
        sortable: 0
        user_edit: 1
    zone_vente: 
        label: Zone de vente
        type: int
        values: 
            array: zones_vente
        dol_extra_field: 1
        default_value: 1
        input: 
            help: Si vous indiquez "Hors-UE" ou "Union Européenne", tous les taux de TVA des lignes actuelles seront mis à 0 de manière irréversible.
    logs: 
        label: Historique
        type: html
        default_value: ''
    prime:
        label: Prime
        type: money
        dol_extra_field: 1
    prime2:
        label: Prime2
        type: money
        dol_extra_field: 1
    replaced_ref: 
        label: Référence remplacée
        input: 
            help: Utiliser ce champ si perte des données de la pièce remplacée
    rib_client:
        label: Rib Client
        dol_extra_field: 1
        type: id_object
        object: rib_client 
        create_form: default
        create_form_values:
            fields:
                fk_soc:
                    field_value: fk_soc
        depends_on: fk_soc
        input:
            type: select
            options:
                callback: getRibArray
        default_value: 0
    
forms: 
    contact:
        title: Ajouter un contact
        rows: 
            - custom: 1
              label: Type
              input_name: type
              input: 
                  type: select
                  options: 
                      1: Contact tiers
                      2: Utilisateur
            - custom: 1
              label: Tiers
              input_name: id_client
              input: 
                  type: search_societe
#                  societe_type: customer
              value: 
                  field_value: fk_soc
              display_if: 
                  field_name: type
                  show_values: 1
            - custom: 1
              label: Contact
              input_name: id_contact
              data_type: id_object
              object: contact
              edit_form: default
              create_form: default
              create_form_values:
                  fields: 
                      fk_soc: 
                          callback: getAddContactIdClient
              value: 
                  request: fields/id_contact
              input: 
                  type: select
                  options: 
                      array: clientContacts
              display_if: 
                  field_name: type
                  show_values: 1
              depends_on: id_client
            - custom: 1
              label: Utilisateur
              input_name: id_user
              input: 
                  type: search_user
              value: 
                  prop:
                      object: 
                          global: user
                      name: id
              display_if: 
                  field_name: type
                  show_values: 2
            - custom: 1
              label: Type de contact
              input_name: tiers_type_contact
              input: 
                  type: select
                  options: 
                      array: externalContactTypes
              display_if: 
                  field_name: type
                  show_values: 1
            - custom: 1
              label: Type de contact
              input_name: user_type_contact
              input: 
                  type: select
                  options: 
                      array: internalContactTypes
              display_if: 
                  field_name: type
                  show_values: 2 
                  
    duplicate:
        force_edit: 1
        rows: 
            is_clone_form: 
                custom: 1
                hidden: 1
                label: Clone
                input_name: is_clone_form
                input: 
                    type: hidden
                value: 1                    
            entrepot: 
                field: entrepot
            client: 
                field: fk_soc
            libelle: 
                field: libelle
            secteur: 
                field: ef_type
            cond_reglement: 
                custom: 1
                label: Conditions de réglement
                input: 
                    type: select
                    options: 
                        array: condReglements
                input_name: fk_cond_reglement
                value: 
                    callback: getCondReglementBySociete
                depends_on: fk_soc,is_clone_form
            mode_reglement: 
                custom: 1
                label: Mode de réglement
                input: 
                    type: select
                    options: 
                        array: modeReglements
                input_name: fk_mode_reglement
                value: 
                    callback: getModeReglementBySociete
                depends_on: fk_soc,is_clone_form
    
    releverFacturation:
        rows:
            - custom: 1
              label: Date début du relevé
              input_name: date_debut
              required: 1
              data_type: date
              input:
                  type: date
            - custom: 1
              label: Date fin du relevé
              input_name: date_fin
              required: 1
              data_type: date
              input:
                  type: date

    use_remise:
        rows: 
            - custom: 1
              label: Remise / avoir à appliquer
              input_name: id_discount
              data_type: int
              input: 
                  type: select
                  options: 
                      array: socAvailableDiscounts
            
    email: 
        rows: 
            - custom: 1
              label: Emetteur
              input_name: from
              input: 
                  type: select
                  options: 
                      array: emailUsersFrom
                      
            - custom: 1
              label: Destinataires
              input_name: mail_to
              input: 
                  type: custom
                  content: 
                      callback: 
                          method: renderMailToInputs
                          params: 
                              - mail_to
                  multiple: 1
              values: 
                  array: mailsTo
              value: 
                  callback: getDefaultMailTo
              required: 1
              
            - custom: 1
              label: Copies à
              input_name: copy_to
              input: 
                  type: custom
                  content: 
                      callback: 
                          method: renderMailToInputs
                          params: 
                              - copy_to
                  multiple: 1
                          
            - custom: 1
              label: Accusé de réception
              input_name: confirm_reception
              data_type: bool
              input: 
                  type: toggle
              default_value: 0
              
            - custom: 1
              label: Modèle de courriel
              input_name: id_model
              input: 
                  type: select
                  options: 
                      array: emailModels
                      
            - custom: 1
              label: Objet
              input_name: mail_object
              input: 
                  type: text
              value: 
                  callback: getEmailTopicByModel
              depends_on: id_model
              
            - custom: 1
              label: Message
              data_type: html
              input_name: msg_html
              input: 
                  type: html
              value: 
                  callback: getEmailContentByModel
              depends_on: id_model
            - custom: 1
              label: Fichiers joints
              input_name: join_files
              data_type: id_object
              input: 
                  type: check_list
                  items: 
                      callback: getAllFiles
#                      array: files
              value: 
                  callback: getJoinFilesValues
              depends_on: id_model
              object: files
              create_form: upload
              create_form_label: Ajouter
              create_form_values: 
                  fields: 
                      parent_module: 
                          prop: module
                      parent_object_name: 
                          prop: object_name
                      id_parent: 
                          prop: id
                          
    acompte: 
        title: Ajouter un acompte
        icon: fas_hand-holding-usd
        rows: 
            - custom: 1
              hidden: 1
              input_name: caisse_active
              input: 
                  type: hidden
              value: 
                  conf: use_caisse_for_payments
            - custom: 1
              label: Payée
              input_name: payee
              data_type: bool
              input: 
                  type: toggle
              value: 1
            - custom: 1
              label: Paiement en caisse
              input_name: use_caisse
              data_type: bool
              input: 
                  type: toggle
              value: 
                  conf: use_caisse_for_payments
              display_if:
                    fields_names: caisse_active,payee
                    caisse_active:
                        hide_values: 0
                    payee:
                        show_values: 1

            - custom: 1
              label: Caisse
              input_name: id_caisse
              data_type: id
              content: 
                  callback: renderCaisseInput
              display_if:
                    fields_names: use_caisse,payee
                    use_caisse:
                        hide_values: 0
                    payee:
                        show_values: 1
            - custom: 1
              label: Compte bancaire
              input_name: bank_account
              data_type: int
              value: 
                  callback: getDefaultBankAccount
              input: 
                    type: select_mysoc_account
              depends_on: id_caisse
            - custom: 1
              label: Mode de paiement
              input_name: id_mode_paiement
              required: 1
              input: 
                  type: select_payment
                  value_type: code
                  include_empty: 1
              display_if: 
                  field_name: payee
                  hide_values: 0
            - custom: 1
              label: N° (chèque ou virement)
              input_name: num_paiement
              input: 
                  type: text
              display_if: 
                    field_name: id_mode_paiement
                    show_values: CHQ,VIR
            - custom: 1
              label: Emetteur (Chèque ou virement)
              data_type: string
              input_name: nom_emetteur
              input: 
                  type: text
              display_if: 
                  field_name: id_mode_paiement
                  show_values: CHQ,VIR
            - custom: 1
              label: Banque émetteur (chèque)
              data_type: string
              input_name: banque_emetteur
              input: 
                  type: text
              display_if: 
                  field_name: id_mode_paiement
                  show_values: CHQ
            - custom: 1
              label: Date de paiement de l'acompte
              data_type: date
              input_name: date
              input:
                  type: date
                  display_now: 1
              display_if: 
                  field_name: payee
                  hide_values: 0
            - custom: 1
              label: Montant
              input_name: amount
              data_type: money
              required: 1
              input: 
                  type: text
                  
    logs: 
        rows: 
            - field: logs

fields_tables: 
    infos: 
        title: Informations
        icon: info-circle
                  
    client: 
        title: Client
        icon: user
        
    payment:
        title: Règlement
        icon: euro
                
    pdf: 
        title: Document
        icon: fas_file-pdf
                                    
    sav_infos: 
        title: Informations
        icon: info-circle
                  
    totals: 
        title: Montants totaux
        icon: euro
                  
    notes:
        title: Notes
        icon: fas_sticky-note
        rows: 
            - field: note_public
            - field: note_private
            - field: logs
    
filters: 
    id_commercial: 
        label: Commercial
        data_type: id_object
        type: user
        input: 
            type: search_user
            include_empty: 1
            empty_label: Aucun
                    
    id_product:
        label: Produit
        data_type: id_object
        type: value
        input: 
            type: search_product
            
    collection:
        label: Collection produit
        type: value
        input: 
            type: select
            options: 
                callback: 
                    method: getProductsTagsByTypeArray
                    params: 
                        - collection
                        
    nature:
        label: Nature produit
        type: value
        input: 
            type: select
            options: 
                callback: 
                    method: getProductsTagsByTypeArray
                    params: 
                        - nature
                        
    categorie:
        label: Catégorie produit
        type: value
        input: 
            type: select
            options: 
                callback: 
                    method: getProductsTagsByTypeArray
                    params: 
                        - categorie
                        
    famille:
        label: Famille produit
        type: value
        input: 
            type: select
            options: 
                callback: 
                    method: getProductsTagsByTypeArray
                    params: 
                        - famille
                        
    gamme:
        label: Gamme produit
        type: value
        input: 
            type: select
            options: 
                callback: 
                    method: getProductsTagsByTypeArray
                    params: 
                        - gamme
                        
filters_panels: 
    default: 
        filters: 
            ref: 
            type: 
            fk_statut: 
            paiement_status: 
                show: 0
            ef_type: 
            entrepot: 
            fk_soc: 
            ref_client: 
            client:status: 
                label: Statut client
            libelle: 
            id_product:
            id_commercial: 
            fk_user_author: 
            fk_user_valid: 
            datec: 
            date_valid: 
            total_ht: 
            total:
            total_ttc: 
            zone_vente:
                    
lists_cols: 
    ref: 
        object_link: 1
    commercial: 
        label: Commercial
        value: 
            callback: displayCommercial
        search: 
            input: 
                type: search_user
    nbNotes:
        label: Nombre de notes
        value:
            callback: displayCountNotes
    total_pa: 
        label: Total achats (hors reval)
        value: 
            callback: displayTotalPA
        has_total: 1
    client_facturation: 
        label: Client Fact.
        value: 
            callback: displayClientFact
    tx_marge: 
        label: Tx marge
        value: 
            callback: displayTxMarge
    tx_marque: 
        label: Tx marque
        value: 
            callback: displayTxMarque
        
lists: 
    default: 
        configurable: 1
        total_row: 1
        checkboxes: 1
        filters_panel: default
        bulk_actions:
            delete: 
                icon: fas_trash-alt
                onclick: deleteSelectedObjects('list_id', $(this))
        n: 10
        sort_field: rowid
        sort_way: desc
        add_form_name: default
        edit_btn: 1
        edit_form: default
        delete_btn: 1
        modal_view: full
        page_btn: 1
        extra_btn: 
            callback: getDefaultListExtraButtons
        list_filters: 
            callback: getListFilters
            
    mini_user_create:
        extends: default
        n: 5
        cols: 
            fk_user_author: unset
            entrepot: unset
            ef_type: unset
            date_create: unset
            commercial: unset
            
views: 
    default: 
        objects_change_reload: BimpFile,BimpNote,RemiseGlobale
        delete_btn: 1
        edit_form: default
        footer_extra_btn: 
            callback: getActionsButtons
        rows: 
            - cols: 
                - type: rows
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  rows: 
                      - cols: 
                            - type: fields_table
                              fields_table:
                                  name: infos
                                  
                      - cols: 
                            - type: fields_table
                              fields_table: 
                                  name: payment
                      
                - type: rows
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  rows: 
                      - cols: 
                          - type: fields_table
                            fields_table: 
                                name: client
                                
                      - cols:
                            - type: fields_table
                              fields_table: 
                                  name: notes
        
    content_infos: 
        rows: 
            - cols: 
                - type: rows
                  col_lg: 7
                  col_md: 7
                  col_sm: 12
                  rows: 
                      - cols: 
                            - type: custom
                              custom: 
                                  callback: renderRemisesGlobalesList
                            - type: fields_table
                              fields_table: 
                                  name: totals
                            - type: custom
                              custom:
                                  callback: renderMarginsTable
                - type: fields_table
                  col_lg: 5
                  col_md: 5
                  fields_table:
                      name: pdf
                      
            - cols: 
                - type: custom
                  col_lg: 5
                  col_md: 5
                  col_sm: 12
                  custom: 
                      callback: renderContentExtraLeft
                - type: custom
                  col_lg: 7
                  col_md: 7
                  col_sm: 12
                  custom: 
                      callback: renderContentExtraRight
                
    content: 
        no_reload: 1
        rows:
            - cols: 
                - type: view
                  view: 
                      name: content_infos
                      panel: 0
            - cols: 
                - type: list
                  list: 
                      name: default
                      children: lines
                      title: Lignes

    extra: 
        panel_header: 0
        panel_footer: 0
        no_borders: 1
        rows: 
            - cols: 
                - type: custom
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  custom: 
                      callback: renderLinkedObjectsTable

                - type: custom
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  custom: 
                      callback: renderEventsTable
                          
    full: 
        objects_change_reload: Bimp_File,RemiseGlobale
        rows: 
            - cols: 
                - type: object_header
            - cols: 
                - type: view
                  view: 
                      name: default
            - cols: 
                - type: view
                  view: 
                      name: extra
            - cols: 
                - type: view
                  view: 
                      name: content
            - cols:
                - type: custom
                  custom: 
                      callback: 
                          method: renderNotesList
                          params:
                              - 1

stats_lists_cols: 
    tot_ht: 
        label: Total HT
        type: sum
        data_type: money
        decimals: 2
        field: total_ht
    tot_ttc: 
        label: Total TTC
        type: sum
        data_type: money
        decimals: 2
        field: total_ttc
    nb: 
        label: Nb pièces
        type: count
                    
stats_lists: 
    default: 
        n: 10
        configurable: 1
        filters_panel: default
        group_by_options: 
            - entrepot
            - ef_type
            - fk_statut
            - fk_soc
            - fk_cond_reglement
            - fk_mode_reglement
            - fk_availability
            - fk_user_author
            - fk_user_valid
            - zone_vente
        cols: 
            tot_ht:
            tot_ttc:
            nb: 
               
views_lists: 
    default:
        objects_change_reload: BS_Ticket
#        title: Tickets Hotline
        component_name: default
        component_type: card
        view_btn: 0
        add_btn: 0
        edit_btn: 0
#        edit_form: default
        item_col_lg: 12
        item_col_md: 12
        item_modal_view: default
        n: 5
        pagination: 1
        sort_field: datec
        sort_way: desc