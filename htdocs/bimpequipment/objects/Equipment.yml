table: be_equipment
controller: equipment
icon: fas_desktop

header_list_name: default
header_edit_form: default

list_page_url: 
    controller: index
            
nom_url: 
    syntaxe: <ref>
    card: default
    
labels:
    name: équipement

objects:
    product:
        instance:
            bimp_object: unset
            dol_object: product
        cards: 
            default: 
                type: product_card
                
    bimp_product: 
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: 
                module: bimpcore
                name: Bimp_Product
            id_object: 
                field_value: id_product
                
    contrat:
        relation: none
        instance:
            id_object: unset
            
    places: 
        label: Emplacements
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BE_Place
            
    facture: 
        instance: 
            bimp_object: unset
            dol_object: 
                module: compta/facture
                file: facture
                
    bimp_facture: 
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: 
                module: bimpcommercial
                name: Bimp_Facture
            id_object: 
                field_value: id_facture
                
    commandeFourn:
        instance:
            bimp_object: 
                module: bimpcommercial
                name: Bimp_CommandeFourn
                
    factureFourn:
        instance:
            bimp_object: 
                module: bimpcommercial
                name: Bimp_FactureFourn

associations:
    achatsCommFourn_Equipments:
        type: reverse
        object: commandeFourn
        label: Commandes fournisseur
        input:
            type: search_object
            object: commandeFourn
            
    achatsFactFourn_Equipments:
        type: reverse
        object: factureFourn
        label: Facture fournisseur
        input:
            type: search_object
            object: factureFourn
            
    contrats:
        object: contrat
        display:
            default:
                type: callback
        label: Contrats
        input:
            type: search_list
            search_list:
                table: contrat
                field_return_value: a.rowid
                field_return_label: a.ref
                options:
                    default:
                        label: Recherche par référence contrat
                        fields_search: a.ref,a.rowid
                        join: societe s
                        join_on: a.fk_soc = s.rowid
                        join_return_label: s.nom
                        help: Entrez la référence ou l'ID d'un contrat
                    by_client:
                        label: Recherche par client
                        fields_search: s.nom,s.code_client
                        join: societe s
                        join_on: a.fk_soc = s.rowid
                        join_return_label: s.nom
                        help: Entrez le nom ou le code d'un client
                
fields: 
    id_product: 
        label: Produit
        type: id_object
        object: bimp_product
        default_value: 0
        input:
            type: search_list
            search_list: 
                table: product p
                field_return_value: p.rowid
                field_return_label: p.label,p.ref
                label_syntaxe: <label_2> - <label_1>
                join: product_extrafields pe
                join_on: p.rowid = pe.fk_object
                fields_search: p.rowid,p.ref,p.label,p.barcode
                filters: 
                    pe.serialisable: 1
            help: Entrez la référence, le nom, le code-barre ou l'id d'un produit pour effectuer une recherche
        displays:
            card:
                type: card
                card: default
                
    product_label: 
        label: Désignation produit
        required_if: id_product=0
        display_if: 
            field_name: id_product
            show_values: 0,
        input: 
            help: Utilisez ce champ si cet équipement ne correspond à aucun produit enregistré
            
    type: 
        label: Type
        values: 
            array: types
        
    serial: 
        label: Numéro de série
        size: 128
        required: 1
        search:
            type: value_part
            part_type: beginning
            
    old_serial:
        label: Ancien(s) serial
        type: text
        size: 300
            
    imei: 
        label: N° IMEI
        
    imei2: 
        label: N° IMEI2
        
    meid: 
        label: N° MEID
        
    ref_immo: 
        label: Réf. immobilisation
        default_value: ''
        
#   A suppr.
    available: 
        label: Disponible à la vente
        type: bool
        default_value: 1
        
#   A suppr.     
    return_available: 
        label: Disponible pour retour
        type: bool
        default_value: 1
        
    id_commande_line_return: 
        label: Ligne commande retour
        type: id
        default_value: 0
        
    date_purchase: 
        label: Date d'achat
        type: date
        required: 0
        search:
            type: date_range
        
    date_warranty_end: 
        label: Date de fin de garantie
        type: date
        required: 0
        search:
            type: date_range
            
    date_immo: 
        label: Date de première immobilisation
        type: date
        
    warranty_type: 
        label: Type de garantie
        type: string
        
    prix_achat:
        label: Prix d'achat HT
        type: money
        default_value: 0
        
    achat_tva_tx: 
        label: Tx TVA achat
        type: percent
        
    prix_vente_except: 
        label: Prix de vente exceptionnel (TTC)
        type: money
        default_value: 0
        input: 
            help: Laisser vide pour utiliser le prix de vente du produit
            
    vente_tva_tx: 
        label: Tx TVA vente
        type: percent
        
    prix_vente: 
        label: Prix de vente TTC
        type: money
        default_value: 0
        
    date_vente: 
        label: Date de vente
        type: datetime
        input: 
            type: hidden
            
    origin_element: 
        label: Element d'origine
        values: 
            array: origin_elements
    
    origin_id_element: 
        label: ID de l'élément d'origine
        type: int
        default_value: 0
        displays: 
            default: 
                type: callback
                method: displayOriginElement
        display_if: 
            field_name: origin_element
            hide_values: 0
        input: 
            type: custom
            content: 
                callback: getOriginIdElementInput
        depends_on: origin_element
        
    id_facture:
        label: Facture
        type: id_object
        object: bimp_facture
        default_value: 0
        input: 
            type: hidden
                
    admin_login: 
        label: Login admin
        type: string
        size: 128
        required: 0
        searchable: 0
        
    admin_pword: 
        label: Mot de passe admin
        type: string
        size: 128
        required: 0
        searchable: 0        
        
    note:
        label: Note
        type: text
        size: 800
        required: 0
        sortable: 0
        searchable: 0
        
    id_package: 
        label: Package
        type: id_object
        object: package
        default_value: 0

fields_tables: 
    default: 
        panel: 1
        title: Informations
        icon: info-circle
        rows:
            - field: serial
            - field: imei
            - field: imei2
            - field: meid
            - field: ref_immo
            - field: date_immo
            - label: Disponibilité
              value: 
                  callback: displayAvailability
            - label: Réservé / transfert en cours
              value: 
                  callback: displayReserved
            - field: date_purchase
            - field: prix_achat
            - field: achat_tva_tx
            - field: prix_vente_except 
            - field: warranty_type
            - field: date_warranty_end
            - field: note
              edit: 1
            - field: old_serial
    
    objects: 
        panel: 1
        title: Objets liés
        icon: fas_link
        rows: 
            - label: Produit
              value: 
                  callback: 
                      method: displayProduct
                      params: 
                          - card
            - label: Package
              value: 
                  callback: 
                      method: displayPackage
                      params: 
                          - nom_url
              show:
                  field_value: id_package
            - label: Type d'élément d'origine
              field: origin_element
              show: 
                  field_value: origin_id_element
            - field: origin_id_element
              label: Element d'origine
              show: 
                  field_value: origin_id_element
            - association: contrats
              edit: 1
            - association: achatsCommFourn_Equipments
              edit: 1
              show:
                  conf: useLinkAchatFournEquipment
            - association: achatsFactFourn_Equipments
              edit: 1
              show:
                  conf: useLinkAchatFournEquipment
    
    vente: 
        show: 
            callback: isSold
        panel: 1
        title: Vente
        icon: euro
        rows: 
            - field: prix_vente
              label: Vendu au prix TTC de
            - field: vente_tva_tx
            - field: date_vente
            - field: id_facture
            
views:
    infos:
        objects_change_reload: BE_Place
        edit_form: default
        delete_btn: 1
        rows:
            - cols: 
                  - type: fields_table
                    col_lg: 8
                    col_md: 7
                    col_sm: 12
                    fields_table:
                        name: default  
                        
                  - type: rows
                    col_lg: 4
                    col_md: 5
                    col_sm: 12
                    rows: 
                        - cols: 
                            - type: fields_table
                              fields_table: 
                                  name: objects
                        - cols: 
                            - type: fields_table
                              fields_table:
                                  name: vente
                              
    default: 
        objects_change_reload: BE_Place
        rows: 
            - cols: 
                - type: object_header
            - cols: 
                - type: view
                  view: 
                      name: infos
            - cols: 
                - type: list
                  list: 
                      name: default
                      children: places
                      
    reservations: 
        panel: 0
        rows: 
            - cols: 
                  - type: custom
                    custom: 
                        callback: renderReservationsList
                    
forms:
    default:
        rows: 
            - field: serial
            - field: imei
            - field: imei2
            - field: meid
            - field: id_product
              show: 
                  callback: showProductInput
            - field: product_label
            - field: type
            - field: date_purchase
            - field: prix_achat
            - field: achat_tva_tx
            - field: prix_vente_except
            - field: vente_tva_tx
            - field: origin_element
            - field: origin_id_element
            - field: warranty_type
            - field: date_warranty_end
            - field: note
            - association: contrats
            - object: places
            
    light:
        force_edit: 1
        rows:
            - field: serial
            - field: imei
            - field: imei2
            - field: meid
            - field: id_product
              show: 
                  callback: showProductInput
            - field: product_label
            - field: type
            - field: date_purchase
            - field: warranty_type
            - field: date_warranty_end
            - association: contrats
            
    light_place: 
        rows: 
            - field: serial
            - field: imei
            - field: imei2
            - field: meid
            - field: id_product
              show: 
                  callback: showProductInput
            - field: product_label
            - field: type
            - field: date_purchase
            - field: warranty_type
            - field: date_warranty_end
            - object: places
            
filters: 
    in_package: 
        label: inclus dans un package
        type: check_list
        items: 
            0: NON
            1: OUI

    place_date_end:
        data_type: date
        label: Date de départ (emplacement)
        type: date_range
        exclude_btn: 0
        
filters_panel: 
    default: 
        filters: 
            id_product: 
            serial: 
            imei: 
            imei2: 
            meid: 
            type: 
            date_purchase: 
            date_vente:
            in_package:
            places:position:
            places:type:
            places:id_entrepot:
            places:id_user:
            places:id_client
            places:infos: 
            places:date:
            place_date_end:
            
lists_cols: 
    product: 
        label: Produit
        value: 
            callback: 
                method: displayProduct
                params: 
                    - nom_url
        search: 
            type: value_part
    place: 
        label: Emplacement
        value:
            callback: displayCurrentPlace
        search: 
            type: value_part
    place2: 
        label: Type emplacement
        value:
            callback: displayCurrentPlaceType
        search: 
            type: values
            input: 
                type: select
                options: 
                    options: 
                        array: typesPlace
    reserved: 
        label: Réservé / transfert en cours
        value: 
            callback: displayReserved
        search: 
            type: values
            input: 
                type: select
                options: 
                    options: 
                        array: hasReservations
    oldSn:
        label: Ancien SN
        value: 
            callback: displayOldSn
    id_facture: 
        label: Facture vente
    pack_serial: 
        label: N° de série
        value: 
            callback: 
                method: getNomUrl
                params: 
                    - 1
                    - 1
                    - 1
                    - default
    pack_product: 
        label: Produit
        value: 
            callback: 
                method: displayProduct
                params: 
                    - nom_url
                    - 0
                    - 1

lists:
    default: 
        checkboxes: 1
        configurable: 1
        bulk_actions: 
            - label: Supprimer les équipements sélectionnés
              icon: fas_trash-alt
              onclick: deleteSelectedObjects('list_id', $(this));
            - label: Générer étiquettes
              icon: fas_sticky-note
              onclick: setSelectedObjectsAction($(this), 'list_id', 'generateEtiquette', {}, null, null, true)
        filters_panel: default
        sort_field: date_create
        sort_way: desc
        n: 10
#        list_filters: 
#            callback:
#                method: getListFilters
        extra_btn: 
            callback: getDefaultListExtraBtn
        add_form_name: default
        edit_btn: 1
        update_btn: 1
        delete_btn: 1
        view_btn: 1
        page_btn: 1
        total_row: 1
        modal_view: default
        cols:
            product: 
            serial:
            place2: 
            place: 
            id_package: 
            user_create:
            prix_achat:
                
    product: 
        extends: default
        cols: 
            product: unset
        

    client: 
        configurable: 1
        sort_field: date_create
        sort_way: desc
        n: 10
        edit_btn: 1
        update_btn: 1
        delete_btn: 1
        view_btn: 1
        page_btn: 1
        modal_view: default
        cols:
            product: 
            serial:
            prix_achat:
            prix_vente: 
            vente_tva_tx: 
            id_facture: 
        
    package: 
        objects_change_reload: BE_Package
        enable_search: 1
        enable_sort: 0
        checkboxes: 1
        bulk_actions: 
            - label: Retirer les équipements sélectionnés
              icon: fas_trash-alt
              onclick: removeSelectedEquipmentsFromPackage('list_id', $(this));
            - label: Générer étiquettes
              icon: fas_sticky-note
              onclick: setSelectedObjectsAction($(this), 'list_id', 'generateEtiquette', {}, null, null, true)
        sort_field: serial
        sort_way: asc
        n: 20
        extra_btn: 
            callback: getPackageListExtraBtn
        cols: 
            pack_serial: 
            pack_product:
                            
    immos: 
        enable_search: 0
        checkboxes: 0
        sort_field: serial
        sort_way: asc
        n: 10
        modal_view: default
        cols: 
            serial: 
            product: 
            id_package: 
            ref_immo:
            place2:
            place:
            prix_achat:
                
    inventaire:
        extends: default
        delete_btn: 0
        add_btn: 0
        bulk_actions: unset
        
    inventaireManquant:
        extends: inventaire
#        cols:
#            place: unset
#            place2: unset
        bulk_actions:
            - label: Déplacer dans Vols
              icon: fas_trash-alt
              onclick: setSelectedObjectsAction($(this), 'list_id', 'moveToPlaceType', {'place_type':6}, '', 'Déplacer dans vol ?', true)
            - label: Déplacer dans Enquête
              icon: fas_trash-alt
              onclick: setSelectedObjectsAction($(this), 'list_id', 'moveToPlaceType', {'place_type':90}, '', 'Déplacer dans enquête ?', true)
              
    inventaireEnTrop:
        extends: inventaire
        bulk_actions: 
            - label: Retirer de l'inventaire
              icon: fas_trash-alt
              onclick: setSelectedObjectsAction($(this), 'list_id', 'removeInventaire', {}, '', 'Retirer de l\'inventaire ?', true)
              
searches:
    default:
        has_serial: 1
        fields_search: 
            - a.product_label
            - a.serial
            - CONCAT('S', a.serial)
            - a.imei
            - a.imei2
            - a.meid
            - a.old_serial
        fields_return: 
            - a.serial
        label_syntaxe: '<a.serial>'
        
cards: 
    default: 
        view_btn: 1
        fields: 
            - icon: fas_box
              label: Produit
              value: 
                  callback:
                      method: displayProduct
                      params:
                          - nom_url
            - icon: barcode
              field: serial
            - field: imei
            - field: imei2
            - field: meid
            
    test: 
        fields: 
            - icon: fas_box
              label: Produit
              value: 
                  callback:
                      method: displayProduct
                      params:
                          - nom_url
            - icon: fas_info
              label: info
              value: 
                  callback: getInfoCard
