table: bimpcore_note
common_fields: 1
icon: fas_sticky-note

mode_archive: 0

labels:
    name: note
    is_female: 1

parent_module:
    field_value: obj_module
parent_object:
    field_value: obj_name
parent_id_property: id_obj

nom_url:
    card: default

objects:
    user_dest: 
        extends: user
        instance: 
            id_object: 
                field_value: fk_user_dest
                
    user_group:
        relation: hasOne
        delete: 0
        instance:
            dol_object:
                module: user
                file: usergroup
                class: UserGroup
            id_object:
                field_value: fk_group_dest
    author_group:
        relation: hasOne
        delete: 0
        instance:
            dol_object:
                module: user
                file: usergroup
                class: UserGroup
            id_object:
                field_value: fk_group_author

fields:
    obj_type:
        label: Type objet
        input:
            type: hidden
    obj_module:
        label: Module
        input:
            type: hidden
    obj_name:
        label: Nom objet
        input:
            type: hidden
    id_obj:
        label: ID objet
        input:
            type: hidden
    id_parent_note:
        label: Note Parente
        type: id
        default_value: 0
    type_author:
        label: Type Auteur
        type: int
        values:
            array: types_author
        default_value: 1
    id_societe:
        label: Société
        type: id_object
        object: societe
        display_if:
            field_name: type_author
            show_values: 2
    email:
        label: E-mail
        display_if:
            field_name: type_author
            show_values: 3
    visibility:
        label: Visibilité
        type: int
        values:
            array: visibilities
        default_value: 10
    content:
        label: Texte
        type: html
        hashtags: 1
        no_strip_tags: 1
        input:
            field_path: 1
            field_path_module:
                field_value: obj_module
            field_path_object_name:
                field_value: obj_name
            hashtags: 1
            auto_expand: 1
            rows: 3
            note: 1
        default_value:
            callback: getContentDefaultValue
        depends_on: note_modele,obj_module,obj_name,id_obj
    viewed:
        label: Vue
        type: bool
        default_value: 0
    type_dest:
        label: Type Destinataire
        type: int
        values:
            array: types_dest
        default_value: 0
    fk_user_dest:
        label: Utilisateur destinataire
        type: id_object
        object: user_dest
        input:
            type: search_user
            include_empty: 1
        display_if:
            field_name: type_dest
            show_values: 1
    fk_group_dest:
        label: Groupe destinataire
        type: id_object
        object: user_group
        input:
            type: search_group
            include_empty: 1
        display_if:
            field_name: type_dest
            show_values: 4
        values:
            array: userGroups
    
    auto:
        label: Note Auto
        type: bool
        default_value: 0
    
    delete_on_view:
        label: Suppression après vue
        type: boold
        default_value: 0
    
    fk_group_author:
        label: Group
        type: id_object
        object: author_group
        display_if:
            field_name: type_author
            show_values: 4
        values:
            array: userUserGroups
            
    email_cc: 
        label: Emails en copie
        type: text

forms:
    default:
        rows:
            obj_type:
                field: obj_type
            obj_module:
                field: obj_module
            obj_name:
                field: obj_name
            id_obj:
                field: id_obj
            type_author:
                field: type_author
            fk_group_author:
                field: fk_group_author
            id_societe:
                field: id_societe
            email:
                field: email
            visibility:
                field: visibility
            type_dest:
                field: type_dest
            fk_user_dest:
                field: fk_user_dest
            fk_group_dest:
                field: fk_group_dest
            email_dest:
                custom: 1
                label: Destinataire
                input_name: email_dest
                input:
                    type: select
                    options:
                        callback: getEmailDestsArray
                display_if:
                    field_name: type_dest
                    show_values: 2
            email_dest_custom:
                custom: 1
                label: E-mail destinataire
                input_name: email_dest_custom
                input:
                    type: text
                display_if:
                    fields_names: type_dest,email_dest
                    type_dest:
                        show_values: 2
                    email_dest:
                        show_values: custom
            email_to_copy:
                custom: 1
                label: Copies e-mail
                input_name: email_to_copy
                input:
                    type: text
#                    type: select
#                    options:
#                        callback: getEmailToCcArray
                    multiple: 1
                display_if:
                    field_name: type_dest
                    show_values: 2
                value: 
                    callback: getEmailToCc
#                    callback: getEmailCcToAddArray
            email_from:
                custom: 1
                label: Emetteur
                input_name: email_from
                input:
                    type: text
                value:
                    callback: getMailFrom
                display_if:
                    field_name: type_dest
                    show_values: 2
            note_modele:
                custom: 1
                label: Modèle
                show:
                    conf: use_notes_models
                input_name: note_modele
                data_type: int
                content:
                    callback: renderModelInput
            content:
                field: content
    
    edit:
        rows:
            -   field: visibility
            -   field: content
    
    msg:
        extends: default
        rows:
            fk_group_author: unset
            id_societe: unset
            email: unset
            visibility: unset
            type_author:
                hidden: 1
    
    rep:
        rows:
            -   field: obj_type
            -   field: obj_module
            -   field: obj_name
            -   field: id_obj
            -   custom: 1
                label: Type auteur
                input_name: type_author
                input:
                    type: select
                    options:
                        1: Utilisateur
                        4: Group
                value:
                    callback:
                        method: getInitData
                        params:
                            - type_dest
            -   field: fk_group_author
                value:
                    callback:
                        method: getInitData
                        params:
                            - fk_group_dest
            -   field: type_dest
            -   field: fk_group_dest
            -   field: fk_user_dest
                edit: 0
            -   custom: 1
                label: Destinataire
                input_name: email_dest
                input: 
                    type: select
                    options: 
                        callback: getEmailDestsArray
            -   custom: 1
                label: E-mail destinataire
                input_name: email_dest_custom
                input:
                    type: text
                value:
                    callback: getMailTo
                display_if:
                    fields_names: type_dest,email_dest
                    type_dest:
                        show_values: 2
                    email_dest:
                        show_values: custom
            -   custom: 1
                label: Copies e-mail
                input_name: email_to_copy
                input:
                    type: text
                    multiple: 1
                display_if:
                    field_name: type_dest
                    show_values: 2
            -   custom: 1
                label: Emetteur
                input_name: email_from
                input:
                    type: text
                value:
                    callback: getMailFrom
                display_if:
                    field_name: type_dest
                    show_values: 2
            -   custom: 1
                label: Modèle
                show:
                    conf: use_notes_models
                input_name: note_modele
                data_type: int
                content:
                    callback: renderModelInput
            -   custom: 1
                label: Texte
                input_name: content
                content:
                    callback: renderCustomContentInput
                depends_on: note_modele
        
        after_content:
            callback: getHisto

lists_cols:
    date_create:
        label: Date
    author:
        label: Auteur
        value:
            callback: displayAuthor
    to:
        label: Destinataire(s)
        value:
            callback: displayDestinataire
    chatmsg:
        label: ''
        value:
            callback: displayChatMsg
    parent:
        label: Objet lié
        value:
            callback: getParentLink

lists:
    default:
        title: Notes
        icon: fas_sticky-note
        filters_panel: default
        checkboxes: 1
        bulk_actions:
            -   label: Supprimer les notes sélectionnées
                icon: fas_trash-alt
                onclick: deleteSelectedObjects('list_id', $(this));
                btn_class: deleteSelectedObjects
        extra_bulk_actions:
            callback: getListsExtraBulkActions
        sort_field: date_create
        sort_way: desc
        n: 50
        edit_btn: 1
        edit_form: edit
        delete_btn: 1
        add_form_name: default
        header_buttons:
            callback: getListHeaderButtons
        extra_btn:
            callback: getListExtraBtn
        cols:
            date_create:
            author:
            visibility:
                edit: 1
            content:
                min_width: 400
            to:
            viewed:
                edit: 1
            user_update:
                show:
                    callback: iAmAdmin
            date_update:
                show:
                    callback: iAmAdmin
    
    global:
        extends: default
        add_form_name: unset
        add_btn: 0
    
    public:
        title: Suivi
        icon: fas_history
        checkboxes: 0
        configurable: 0
        enable_search: 0
        sort_field: date_create
        sort_way: asc
        n: 50
        cols:
            author:
            date_create:
            content:
                label: Message
                edit: 1
    
    message:
        extends: default
        title: Messages
        add_form_name: msg
        add_form_values:
            fields:
                type_author: 1
                type_dest: 1
        cols:
            visibilite: unset
    
    chat:
        title: Messages
        icon: fas_comments
        enable_search: 0
        no_rows_borders: 1
        n: 100
        add_form_name: msg
        add_btn_label: Nouveau message
        add_form_title: Nouveau message
        add_form_values:
            fields:
                type_author: 1
                type_dest: 1
        cols:
            chatmsg:
    
    bal:
        extends: default
        cols:
            parent:
    
    linked:
        extends: default
        cols:
            parent:
        add_form_name: unset

searches:
    default:
        fields_search:
            - a.id
        fields_return:
            - a.id
        label_syntaxe: 'Note #<a.id>'

filters_panels:
    default:
        filters:
            user_create:

cards:
    default:
        status: viewed
        fields:
            -   label: Objet
                value:
                    callback: getParentLink
            -   field: date_create
            -   label: Auteur
                value:
                    callback: displayAuthor
            -   field: content
