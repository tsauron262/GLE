table: br_reservation

common_fields: 1
icon: fas_lock

labels: 
    name: réservation
    is_female: 1

objects:
    entrepot: 
        relation: hasOne
        delete: 0
        instance: 
            dol_object: 
                module: product/stock
                file: entrepot
            id_object: 
                field_value: id_entrepot
        
    commercial: 
        extends: user
        instance: 
            id_object: 
                field_value: id_commercial
                
    commande_client: 
        extends: commande
        relation: hasOne
        instance: 
            id_object: 
                field_value: id_commande_client
        cards: 
            default: 
                type: commande_client_card
                
    commande_client_line: 
        relation: hasOne
        instance: 
            bimp_object: 
                module: bimpcommercial
                name: Bimp_CommandeLine
            id_object: 
                field_value: id_commande_client_line

    commande_fournisseur:
        relation: hasOne
        delete: 0
        instance: 
            dol_object: 
                module: fourn
                file: fournisseur.commande
                class: CommandeFournisseur
            id_object: 
                field_value: id_commande_fournisseur
        cards: 
            default: 
                type: commande_fournisseur_card
         
    sav_product:
        relation: hasOne
        delete: 0
        instance: 
            bimp_object:
                module: bimpsupport
                name: BS_SavProduct
            id_object: 
                field_value: id_sav_product
                
    sav_propal_line:
        relation: hasOne
        delete: 0
        instance: 
            bimp_object:
                module: bimpsupport
                name: BS_SavPropalLine
            id_object: 
                field_value: id_sav_propal_line
                
    shipment: 
        instance: 
            bimp_object: 
                module: bimplogistique
                name: BL_CommandeShipment
                
    transfer: 
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: 
                module: bimptransfer
                name: Transfer
            id_object: 
                field_value: id_transfert
        
fields: 
    ref: 
        label: Référence
        input: 
            type: hidden
            
    id_entrepot:
        label: Centre
        type: id_object
        object: entrepot
        required: 1
        input: 
            type: search_entrepot
            
    type:
        label: Type de réservation
        type: int
        values:
            array: types
        required: 1
        default_value: 1
        
    status: 
        label: Statut
        type: int
        values: 
            array: status_list
        input: 
            options: 
                array: statusList
        required: 1
        depends_on: type
    
    id_commercial: 
        label: Commercial
        type: id_object
        object: commercial
        default_value: 0
        input: 
            type: search_user
        display: 
            nom_url: 
                type: nom_url
                modal_view: default
    
    id_client: 
        label: Client
        type: id_object
        object: client
        input: 
            type: search_societe
            societe_type: customer
            help: Entrez un nom ou un code client pour effectuer une recherche
        display_if: 
            field_name: type
            hide_values: 2
    
    id_equipment: 
        label: Equipement
        type: id_object
        object: equipment
        input: 
            type: search_list
            search_list: 
                table: be_equipment
                fields_search: id,serial
                field_return_label: id,serial
                field_return_value: id
                label_syntaxe: Equipement <label_1> - serial "<label_2>"
            help: Entrez un id d'équipement ou un numéro de série pour effectuer une recherche
        display_if: 
            field_name: status
            hide_values: 100
        display: 
            default: 
                type: callback
                method: displayEquipment
                
    id_product: 
        label: Produit
        type: id_object
        object: product
#        input: 
#            type: search_product
#            help: Entrez un nom ou une référence pour effectuer une recherche
        display_if: 
            field_name: id_equipment
            show_values: 0,
        display: 
            card: 
                type: card
                card: default
                
    id_commande_client:
        label: Commande Client
        type: id_object
        object: commande_client
        input: 
            type: search_commande_client
            id_client: 
                field_value: id_client
        display_if: 
            field_name: type
            hide_values: 2,3
        depends_on: id_client
        
    id_commande_client_line: 
        label: Ligne commande client
        type: id_object
        object: commande_client_line
        values: 
            array: commandeClientLines
        display_if: 
            field_name: id_commande_client
            hide_values: 0,
        depends_on: id_commande_client,id_product
        
    id_commande_fournisseur: 
        label: Commande Fournisseur
        type: id_object
        object: commande_fournisseur
        input: 
            type: search_commande_fournisseur
        display_if: 
            field_name: status
            show_values: 100
        display_if: 
            field_name: type
            hide_values: 2,3
            
    id_commande_fournisseur_line:
        label: Ligne de commande fournisseur
        type: id
        values: 
            array: commandeFournisseurLines
        display_if: 
            field_name: id_commande_fournisseur
            hide_values: 0,
        depends_on: id_commande_fournisseur
    
    id_transfert: 
        label: Transfert
        type: id_object
        object: transfer
        input: 
            type: text
        display_if: 
            field_name: type
            show_values: 2
            
    id_sav: 
        label: SAV
        type: id_object
        object: sav
        display_if: 
            field_name: type
            show_values: 4
            
    id_sav_product:
        label: Ligne produit SAV
        type: id_object
        object: sav_product
        display_if: 
            field_name: type
            show_values: 4
            
    id_sav_propal_line:
        label: Ligne devis SAV
        type: id_object
        object: sav_propal_line
        display_if: 
            field_name: type
            show_values: 4
            
    qty: 
        label: Quantité
        type: int
        decimals: 0
        min: 1
        default_value: 1
        display_if: 
            field_name: id_equipment
            show_values: 0,
            
    date_from: 
        label: A partir du
        type: datetime
        input: 
            display_now: 1
        required: 1
        
    date_to: 
        label: Jusqu'au
        type: datetime
        display_if: 
            field_name: type
            show_values: 3
        
    date_shipped:
        label: Expédié le
        type: date
        display_if: 
            field_name: type
            show_values: 1
            
    note: 
        label: Note
        type: text
        input: 
            note: 1
            auto_expand: 1
            
forms: 
    equipment:
        title: 
            callback: getEquipmentFormTitle
        rows: 
            - field: status
            - field: id_user_origin
            - field: id_equipment
              hidden: 1
            - field: date_from
            - field: date_to
            - field: origin_element
            - field: origin_id_element
            - field: note
            
    new_status: 
        rows: 
            - custom: 1
              hidden: 1
              input_name: status
              data_type: bool
              input: 
                  type: hidden
              value: 
                  field_value: status
            - field: id_equipment
              show: 
                  callback: isProductSerialisable
            - custom: 1
              label: Quantité
              input_name: qty
              data_type: qty
              content: 
                  callback: renderNewStatusQtyInput
              show:
                  callback: isProductNotSerialisable
            - custom: 1
              hidden: 1
              input_name: new_status
              data_type: bool
              content: <input type="hidden" name="new_status" value="1"/>
              
    reserve_equipments: 
        no_auto_submit: 1
        rows: 
            - custom: 1
              hidden: 1
              input_name: status
              data_type: bool
              input: 
                  type: hidden
              value: 
                  field_value: status
            - custom: 1
              label: Equipements
              input_name: equipments
              data_type: items_list
              items_data_type: id_object
              object: equipment
              create_form: light_place
              create_form_values: 
                  callback: getEquipmentCreateFormValues
              multiple: 1
              content: 
                  callback: renderReserveEquipmentsInput
        
    remove: 
        rows: 
            - custom: 1
              label: Quantité à retirer
              input_name: qty
              data_type: qty
              content: 
                  callback: renderRemoveQtyInput
              show:
                  callback: isProductNotSerialisable
            - custom: 1
              label: Produit(s) défectueux
              data_type: bool
              input_name: defective
              value: 0
              input: 
                  type: toggle
            - custom: 1
              label: Avoir
              show: 
                  callback: isOrderInvoiced
              input_name: id_avoir
              data_type: int
              input: 
                  type: select
                  options: 
                      array: avoirs
                  select_first: 1 
                  
    shipment: 
        title: Ajouter à une expédition
        rows: 
            - custom: 1
              label: Expédition
              input_name: id_shipment
              data_type: id_object
              object: shipment
              create_form: default
              create_form_values: 
                  fields: 
                      id_commande_client: 
                          callback: getIdCommandeforShipment
              input: 
                  type: select
                  options: 
                      array: shipments
            - custom: 1
              label: Grouper les articles par ligne de commande
              input_name: group_articles
              data_type: bool
              value: 0
              input: 
                  help: Si oui, une seule étiquette sera générée pour toutes les unités d'une ligne de commande
            
fields_tables: 
    default: 
        panel_header: 0
        rows: 
            - field: ref
            - field: id_entrepot
            - field: type
            - field: status
            - field: id_product
              display: card
            - field: id_equipment
              display: card
              show: 
                  callback: isEquipment
            - field: qty
              show: 
                  callback: isProduct
            - field: note
              edit: 1       
              
    commande: 
        title: Infos Commande Client
        rows: 
            - field: id_client
              display: card
            - field: id_commande_client
              display: card
            - field: id_commande_client_line
            
    transfert: 
        title: Infos Transfert
        rows: 
            - field: id_transfert
              display: card
            
    temporaire: 
        title: Infos Réservation temporaire
        rows: 
            - field: date_from
              edit: 1
            - field: date_to
              edit: 1
              
    sav: 
        title: Infos SAV
        rows: 
            - field: id_sav
              display: card
              
views: 
    default: 
        edit_form: default
        delete_btn: 1
        rows:
            - cols: 
                  - type: object_header
            - cols: 
                - type: fields_table
                  col_lg: 6
                  col_md: 6
                  fields_table:
                      name: default
                      
                - type: fields_table
                  col_lg: 6
                  col_md: 6
                  fields_table:
                      name: commande
                  show: 
                      callback: isCommandeClient
               
                - type: fields_table
                  col_lg: 6
                  col_md: 6
                  fields_table:
                      name: transfert
                  show: 
                      callback: isTransfert
                        
                - type: fields_table
                  col_lg: 6
                  col_md: 6
                  fields_table:
                      name: temporaire
                  show: 
                      callback: isTemporaire
                          
                - type: fields_table
                  col_lg: 6
                  col_md: 6
                  fields_table:
                      name: sav
                  show: 
                      callback: isSav

filters_panels: 
    default: 
        filters: 
            - field: type
            - field: id_entrepot
            - field: status
            - field: id_product
            - field: id_equipment
            - field: id_commande_client
            - field: id_transfert
            - field: id_sav
            - field: date_from
            - field: date_to
    
lists_cols: 
    ref: 
        field: ref
    type: 
        field: type
    date_from:
        label: Date de début
        field: date_from
    date_to: 
        label: Date de fin
        field: date_to
    product: 
        field: id_product
        display: nom_url
    stocks: 
        label: Qté dispo
        value: 
            callback: displayProductAvailableQty
    equipment: 
        field: id_equipment
    commande: 
        field: id_commande_client
        display: nom_url
    commercial: 
        field: id_commercial
        display: nom_url
    qty: 
        field: qty
    status:
        field: status
    commande: 
        field: id_commande_client
        display: nom_url
    commercial: 
        field: id_commercial
        display: nom_url
    transfert: 
        field: id_transfert
        display: nom_url
    linked_object: 
        label: Objet lié
        value: 
            callback: displayLinkedObject
        
lists: 
    default: 
        filters_panel: default
        configurable: 1
        checkboxes: 
            callback: canDelete
        bulk_actions: 
            - label: Supprimer les réservations sélectionnées
              icon: fas_trash-alt
              onclick: deleteSelectedObjects('list_id', $(this));
        add_form_name: default
        edit_btn: 1
        update_btn: 1
        delete_btn: 1
        modal_view: default
        sort_field: id
        sort_way: desc
        n: 10
        extra_btn: 
            callback: getListExtraBtn
        cols:
            type: 
            status:
            entrepot: 
            product: 
            equipment: 
            linked_object:
            date_from:
            date_to: 
            qty: 
            stocks: 
                
    commandes: 
        filters_panel: default
        checkboxes: 1
        configurable: 1
        pagination: 0
        bulk_actions: 
            callback: getCommandesListBulkActions
        objects_change_reload: BR_ReservationCmdFourn,BR_ReservationShipment,BL_CommandeShipment
        modal_view: default
        sort_field: id_product
        sort_way: asc
        n: 25
        extra_btn: 
            callback: getListExtraBtn
        cols:
            ref: 
            product: 
            stocks: 
            equipment: 
            qty: 
            status:
                
    entrepot: 
        filters_panel: default
        checkboxes: 1
        configurable: 1
        bulk_actions: 
#            - label: Marquer comme livré au client
#              icon: sign-out
#              onclick: setSelectedReservationStatus($(this), 'list_id', 300);
            - label: Réinitialiser
              icon: undo
              onclick: setSelectedReservationStatus($(this), 'list_id', 0);
        objects_change_reload: BR_ReservationCmdFourn
        modal_view: default
        sort_field: id_product
        sort_way: asc
        n: 25
        extra_btn: 
            callback: getListExtraBtn
        cols:
            ref: 
            date_from:
            product: 
            stocks: 
            equipment: 
            commande: 
            commercial: 
            qty: 
            status: