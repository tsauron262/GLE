dol_object: 
    instance: 
        dol_object: product
        
table: product
primary: rowid
icon: fas_box
controller: product

#force_extrafields_update: 1

header_btn: 
    callback: getActionsButtons
    
header_list_name: default
header_edit_form: card
header_delete_btn: 1

list_page_url:
    controller: products

nom_url: 
    syntaxe: <ref>
    card: detailed

labels: 
    name: produit
    
objects: 
    prices: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: 
                module: bimpcore
                name: Bimp_ProductPrice
    fourn_price: 
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: 
                module: bimpcore
                name: Bimp_ProductFournisseurPrice
            id_object: 
                field_value: id_cur_fp

    fourn_prices: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: 
                module: bimpcore
                name: Bimp_ProductFournisseurPrice
        
    files:
        relation: hasMany
        delete: 1
        instance:
            bimp_object:
                module: bimpcore
                name: BimpFile
        list: 
            filters:
                parent_module: bimpcore
                parent_object_name: Bimp_Product
                
    category: 
        relation: none
        delete: 0
        instance: 
            dol_object: 
                module: categories
                file: categorie
                
    default_entrepot:
        extends: entrepot
        instance:
            id_object: 
                field_value: fk_default_warehouse
                
    default_bimp_entrepot:
        extends: bimp_entrepot
        instance:
            id_object: 
                field_value: fk_default_warehouse
        
    cur_prix_achats: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: 
                module: bimpcore
                name: BimpProductCurPa
        
fields: 
    ref: 
        label: Réf.
        
    label: 
        label: Libellé
        user_edit: 1
        
    description: 
        label: Description
        type: html
        user_edit: 1
        
    url: 
        label: URL publique
        
    note: 
        label: Note
        type: text
        user_edit: 1
        dol_prop: note_private
        
    fk_product_type: 
        label: Type
        dol_prop: type
        values: 
            array: product_type
        type: int
        
    stock: 
        label: Stock réel
        dol_prop: stock_reel
        type: int
        default_value: 0
        
    barcode: 
        label: Code-barres
        user_edit: 1
        
    fk_barcode_type: 
        label: Type de code-barres
        dol_prop: barcode_type
        type: int
        
    price: 
        label: Prix HT
        type: money
        default_value: 0
        decimals: 4
        display_if: 
            field_name: no_fixe_prices
            show_values: 0
        
    price_ttc: 
        label: Prix TTC
        type: money
        display_if: 
            field_name: no_fixe_prices
            show_values: 0
        
    deee: 
        label: ecotaxe
        dol_extra_field: 1
        type: money
        decimals: 4
        default_value: 4
        
    2hotline:
        label: Durée hotline en mois
        type: int
        dol_extra_field: 1
        
    pmp: 
        label: Prix d'achat moyen pondéré
        type: money
        
    id_cur_fp: 
        label: Prix d'achat fournisseur courant
        type: id_object
        object: fourn_price
        default_value: 0
        
    cur_pa_ht: 
        label: Prix d'achat actuel
        type: money
        default_value: 0
        
    cur_pa_origin: 
        label: Type origine pa
        
    cur_pa_id_origin: 
        label: ID origine pa
        type: id
        default_value: 0
        
    pa_prevu: 
        label: Prix d'achat prévu
        dol_extra_field: 1
        type: money
        default_value: 0
        display_if: 
            field_name: no_fixe_prices
            show_values: 0
        
    infos_pa: 
        label: Informations prix d'achat
        dol_extra_field: 1
        type: text
        display_if: 
            field_name: no_fixe_prices
            show_values: 0
        
    default_vat_code: 
        label: Code TVA par défaut
        
    tva_tx: 
        label: Taux de TVA
        type: percent
        default_value: 
            callback: getDefaultTva
        
    recuperableonly: 
        label: TVA récupérable seulement
        dol_prop: tva_npr
        type: bool
        
    tosell: 
        label: En vente
        dol_prop: status
        type: bool
        user_edit: 1
        default_value: 1
        
    tobuy: 
        label: En achat
        dol_prop: status_buy
        type: bool
        user_edit: 1
        default_value: 1
        
    customcode: 
        label: Code douane
        user_edit: 1
        
    fk_country: 
        label: Pays d'origine
        dol_prop: country_id
        type: int
        default_value: 1
        input: 
            type: search_country
        displays: 
            default: 
                type: callback
                method: renderCountry        
                
    weight: 
        label: Poids 
        type: float
        user_edit: 1
        
    weight_units: 
        label: Unité de poids
        type: int
        user_edit: 1
        values:
            array: units_weight
        
    length: 
        label: Longueur
        type: float
        user_edit: 1
        
    length_units: 
        label: Unité de longueur
        type: int
        user_edit: 1
        values:
            array: units_length
        
    width: 
        label: Largeur
        type: float
        user_edit: 1
        
    width_units: 
        label: Unité de largeur
        type: int
        user_edit: 1
        values:
            array: units_length
            
    height: 
        label: Hauteur
        type: float
        user_edit: 1
        
    height_units: 
        label: Unité de hauteur
        type: int
        user_edit: 1
        values:
            array: units_length
        
    surface: 
        label: Surface
        type: float
        user_edit: 1
        
    surface_units: 
        label: Unité de surface
        type: int
        user_edit: 1
        values:
            array: units_surface
        
    volume: 
        label: Volume
        type: float
        user_edit: 1
        
    volume_units:
        label: Unité de volume
        type: int
        user_edit: 1
        values:
            array: units_volume
        
    validate: 
        label: Validé
        dol_extra_field: 1
        type: int
        user_edit: 1
        values: 
            array: status_list
        default_value: 0
        
    serialisable: 
        label: Sérialisable
        type: bool
        dol_extra_field: 1
        default_value: 0
        
    remisable: 
        label: Remisable
        type: bool
        dol_extra_field: 1
        default_value: 1
        
    type2: 
        label: Sous-type
        type: int
        values: 
            array: sousTypes
        dol_extra_field: 1
        default_value: 0
        
    crt: 
        label: Remise CRT
        type: percent
        decimals: 3
        dol_extra_field: 1
        default_value: 0
        user_edit: 1
        
    accountancy_code_sell:
        label: Code comptable Vente (Spécifique)
        type: string
        user_edit: 1
        
    accountancy_code_buy:
        label: Code comptable Achat (Spécifique)
        type: string
        user_edit: 1
        
    deee:
        label: Eco-Taxe
        type: money
        user_edit: 1
        dol_extra_field: 1
        
    rpcp:
        label: Copie privée
        type: money
        dol_extra_field: 1
        
    zone_pr:
        label: Emplacement LYON
        type: text
        dol_extra_field: 1
        
    seuil_stock_alerte:
        label: Limite stock pour alerte
        type: qty
        decimals: 4
        min: none
        unsigned: 0
        user_edit: 1

    desiredstock:
        label: Stock désiré optimal
        type: qty
        decimals: 4
        unsigned: 0
        min: none
        user_edit: 1
        
    physical_stock:
        label: Stock physique
        type: int
        extra: 1
                        
    localtax1_tx:
        label: Taxe locale 1
        type: money
        dol_extra_field: 1
        
    localtax1_type:
        label: Type de taxe locale 1
        type: int
        dol_extra_field: 1
        
    localtax2_tx:
        label: Taxe locale 2
        type: money
        dol_extra_field: 1
        
    localtax2_type:
        label: Type de taxe locale 2
        type: int
        dol_extra_field: 1

    fk_default_warehouse:
        label: Entrepôt par défaut
        type: id_object
        object: default_bimp_entrepot
        default_value: 0
        input:
            type: search_entrepot 
        dol_extra_field: 1
        
    duration:
        label: Durée
        type: string
        
    fk_user_valid:
        label: Valideur
        type: id_object
        object: user
        dol_extra_field: 1
        
    date_valid:
        type: datetime
        label: Date validation       
        dol_extra_field: 1
        
    date_ask_valid:
        type: datetime
        label: Date demande validation
        dol_extra_field: 1
        
    no_fixe_prices: 
        label: Pas de prix fixes
        type: bool 
        user_edit: 1
        default_value: 0
        
    categorie:
        label: Categorie
        dol_extra_field: 1
        type: int
        user_edit: 1
        values:
            callback: 
                method: getValues8sens
                params:
                    - categorie
        default_value: 0
                    
    collection:
        label: Collection
        dol_extra_field: 1
        type: int
        user_edit: 1
        values:
            callback: 
                method: getValues8sens
                params:
                    - collection
        default_value: 0
                    
    nature:
        label: Nature
        dol_extra_field: 1
        default: 0
        type: int
        user_edit: 1
        values:
            callback: 
                method: getValues8sens
                params:
                    - nature
        default_value: 0
                    
    famille:
        label: Famille
        dol_extra_field: 1
        type: int
        user_edit: 1
        values:
            callback: 
                method: getValues8sens
                params:
                    - famille
        default_value: 0
                    
    gamme:
        label: Gamme
        dol_extra_field: 1
        type: int
        user_edit: 1
        values:
            callback: 
                method: getValues8sens
                params:
                    - gamme
        default_value: 0
                    
    fk_user_modif:
        label: Utilisateur modification
        type: id_object
        object: user
        
    fk_user_author:
        label: Créateur
        type: id_object
        object: user
        
    datec:
        type: datetime
        label: Date Création
        
    cto: 
        label: CTO
        dol_extra_field: 1
        
    code_config:
        label: Code configuration
        dol_extra_field: 1
    
    type_compta:
        label: Classement forcé en compta
        dol_extra_field: 1
        values:
            array: type_compta
            
    duree: 
        label: Durée limitée (em mois)
        type: int
        min: 0
        default_value: 0
        input: 
            type: text
            help: Uniquement pour les prestations réalisées au fil du temps
        
forms: 
    # Utiliser plutôt "default" que "card" pour le formulaire principal 
    # Important car tout objet doit avoir un formulaire par défaut s'il est éditable.
    default: 
        rows:
            - field: ref
            - field: code_config
            - field: label
            - field: description
            - field: fk_product_type
            - field: type2
            - field: type_compta
            - field: barcode
            - field: customcode
            - field: accountancy_code_buy
            - field: accountancy_code_sell
            - field: price
            - field: tva_tx
            - field: deee
            - field: rpcp
            - field: crt
            - field: gamme
            - field: categorie
            - field: collection
            - field: nature
            - field: famille
            - field: note
            - field: fk_country
            - field: url
            - field: seuil_stock_alerte
            - field: desiredstock
            - field: 2hotline
            # Measure
#            - field: weight
#            - field: weight_units
#            - field: length
#            - field: length_units
#            - field: width
#            - field: width_units
#            - field: height
#            - field: height_units
#            - field: surface
#            - field: surface_units
#            - field: volume
#            - field: volume_units

    card:
        extends: default
        
    light: 
        force_edit: 1
        rows: 
            - custom: 1
              label: Marque
              input_name: marque
              input: 
                  type: text
              show: 
                  callback: isNotLoaded
            - custom: 1
              label: Ref. constructeur
              input_name: ref_constructeur
              input: 
                  type: text            
              show: 
                  callback: isNotLoaded
            - field: ref
              show: 
                  callback: isLoaded
            - field: label
            - field: description  
            - field: fk_product_type
            - field: type2           
            - field: no_fixe_prices
            - field: serialisable
            - field: price
              label: Prix de vente HT
            - field: tva_tx
            - field: pa_prevu
            - field: infos_pa
            - field: note
            - field: zone_pr
            
    lightFourn:
        extends: light
        rows:
            mailValid:
              custom: 1
              label: Demande de validation
              input_name: mailValid
              input: 
                  type: toggle
                  
    light_fourn_price: 
        extends: light
        rows: 
            pa_prevu: unset
            infos_pa: unset
            
            fp_id_fourn:
                custom: 1
                input_name: has_fourn_price
                data_type: bool
                label: Prix d'achat fournisseur
                content: 
                    callback: renderFournPriceInputs
                
    etiquettes: 
        title: Générer des etiquettes
        icon: fas_sticky-note
        rows: 
            - custom: 1
              label: Type d'étiquette à générer
              input_name: type
              input: 
                  type: select
                  options: 
                      stock: Stock
                      magasin: Magasin
            - custom: 1
              label: Nombre
              input_name: qty
              data_type: int
              input: 
                  type: qty
              decimals: 0
              min: 1
              
    merge: 
        msgs: 
            - content: Attention, cette opération est irreversible
              type: warning
        title: Fusionner
        icon: fas_object-group
        rows: 
            - custom: 1
              label: Fusionner avec
              input_name: id_merged_product
              required: 1
              input: 
                  type: search_product
            - custom: 1
              label: Produit à conserver
              input_name: id_kept_product
              data_type: int
              required: 1
              content: 
                  callback: renderMergeKeptProductInput
              depends_on: id_merged_product                  
              
    price: 
        title: Nouveau prix de vente
        rows: 
            - custom: 1
              label: Base du prix de vente
              input_name: price_base_type
              input: 
                  type: select
                  options: 
                      HT: HT
                      TTC: TTC
            - custom: 1
              label: Taux de TVA
              input_name: tva_tx
              input: 
                  type: select
                  options: 
                      callback: getTaxesByRates
            - custom: 1
              label: Prix de base
              input_name: price_base
              data_type: money
              decimals: 8
              input: 
                  type: text
                  
    mouvement:
        title: Mouvement de stock manuel
        rows: 
            - custom: 1
              label: Sens
              input_name: sens
              input: 
                  type: select
                  options: 
                      0: Entrant (ajout)
                      1: Sortant (retrait)
            - custom: 1
              label: Quantité
              input_name: qty
              data_type: int
              min: 1
              input: 
                  type: qty
                  
            - custom: 1
              input_name: id_entrepot
              label: Entrepôt
              dol_extra_field: 1
              type: id_object
              object: entrepot
              required: 
                  callback: useEntrepot
              input: 
                  type: search_entrepot
              default_value: 
                  callback: getDefaultEntrepot
        
fields_tables: 
    infos: 
        title: Informations
        icon: fas_info-circle
        rows:  
            - field: ref
            - field: code_config
            - field: label
            - field: fk_product_type
            - field: type2
              edit: 1
            - field: type_compta
              edit: 1
            - field: barcode
            - field: customcode
            - field: accountancy_code_buy
            - field: accountancy_code_sell
            - field: description
            - field: note
            - field: url
            
    options: 
        title: Options
        icon: fas_check-square
        rows: 
            - field: serialisable
              edit: 1
            - field: tosell
              edit: 1
            - field: tobuy
              edit: 1
            - field: remisable
              edit: 1
            - field: no_fixe_prices
              edit: 1
            - field: duree
              edit: 1
            - custom: 1
              label: Durée validation
              value:
                callback: renderValidationDuration
            - field: zone_pr
              edit: 1
            
    infos_complementaires:
        title: Catégories
        icon: fas_tags
        rows:
            - field: gamme
              edit: 1
            - field: categorie
              edit: 2
            - field: collection
              edit: 2
            - field: nature
              edit: 1
            - field: famille
              edit: 1

    measures: 
        title: Mesures
        icon: fas_ruler
        rows:
            - field: weight
            - field: weight_units
            - field: length
            - field: length_units
            - field: width
            - field: width_units
            - field: height
            - field: height_units
            - field: surface
            - field: surface_units
            - field: volume
            - field: volume_units
            - field: 2hotline
            
    prices: 
        title: Prix de vente
        icon: fas_euro-sign
        rows:  
            - field: no_fixe_prices
              edit: 1
            - field: price
            - field: price_ttc
            - field: tva_tx
            - field: deee
            - field: rpcp
            - field: crt
            
    prices_buy: 
        title: Prix d'achat
        icon: fas_euro-sign
        rows:  
            - label: Prix d'achat actuel
              show: 
                  callback: hasFixePa
              value: 
                  callback: displayCurrentPaHt
            - field: pmp
            - field: pa_prevu
        
    stock:
        title: Options
        icon: far_check-square
        rows:
            - field: seuil_stock_alerte
              edit: 1
            - field: desiredstock
              edit: 1

views: 
    default: 
        edit_btn: 1
        rows: 
            - cols: 
                - type: fields_table
                  col_lg: 12
                  fields_table: 
                      name: infos
                      
            - cols: 
                - type: fields_table
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  fields_table: 
                      name: prices
                      
                - type: fields_table
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  fields_table: 
                      name: options
    
    fiche:
        edit_btn: 1
        edit_form: light
        delete_btn: 1
        rows:
            - cols: 
                - type: fields_table
                  col_lg: 7
                  col_md: 7
                  fields_table: 
                      name: infos
                - type: fields_table
                  col_lg: 5
                  col_md: 5
                  fields_table: 
                      name: options
                - type: fields_table
                  col_lg: 7
                  col_md: 7
                  col_sm: 12
                  fields_table: 
                      name: infos_complementaires
                      
                - type: fields_table
                  col_lg: 5
                  col_md: 5
                  fields_table:
                      name: measures
    
    product_price:
        objects_change_reload: Bimp_ProductPrice,BimpProductCurPa,Bimp_ProductFournisseurPrice
        rows:
            - cols:
                - type: fields_table
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  fields_table: 
                      name: prices
                
                - type: fields_table
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  fields_table: 
                      name: prices_buy
                     
            - cols: 
                - type: list
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  list: 
                      children: prices
                      name: product
                - type: list
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  show: 
                      callback: hasFixePa
                  list: 
                      children: cur_prix_achats
                      name: product
            - cols: 
                - type: list
                  list: 
                      children: fourn_prices
                      name: default
                - type: custom
                  custom: 
                      callback: renderFournPricesReports
#                - type: custom
#                  col_lg: 12
#                  col_md: 12
#                  custom:
#                      callback: renderListeVente
                      
    product_note:
        rows:
            - cols:
                - type: custom
                  custom:
                      callback: renderNotesList
                      
    product_categorize:
        rows:
            - cols:
                - type: custom
                  custom:
                      callback: renderCategorize
                      
    product_history:
        rows:
            - cols:
                - type: custom
                  custom:
                      callback: renderHistory
                      
    stock:
        rows:
            - cols:
                - type: fields_table
                  col_lg: 6
                  col_md: 6
                  col_sm: 12
                  fields_table: 
                      name: stock
            - cols: 
                - type: custom
                  custom: 
                      callback: renderStocksView
                      
filters_panels: 
    default: 
        filters: 
            ref:
            code_config:
            label:
            fk_product_type:
            barcode:
            serialisable:
            remisable:
            validate:
            tosell:
            tobuy:
            gamme:
            categorie:
            collection:
            nature:
            famille:
      
lists_cols: 
    seuil_stock_alerte: 
        label: Lim. stock
    stock_picto: 
        label: Stock Picto
        value:
            callback: displayStock_picto
    ref_ldlc: 
        label: Ref LDLC
        value: 
            callback:
                method: getRefFourn
                params: 
                    - 230880
    ref_short: 
        label: Réf. fabricant
        value: 
            callback: displayRefShort
    accountancy_code_sell_ue:
       label: Code Comptable Vente (Final UE)
       value:
           callback:
               method: getCodeComptableVente
               params:
                   - 2
    accountancy_code_sell_ex:
       label: Code Comptable Vente (Final Export)
       value:
           callback:
               method: getCodeComptableVente
               params:
                   - 3
    accountancy_code_sell_reel:
        label: Code Comptable Vente (Final France)
        value:
            callback: getCodeComptableVente
    accountancy_code_buy_reel:
        label: Code Comptable Achat (Final France)
        value:
            callback: getCodeComptableAchat
    last_fourn_name:
        label: Derier fournisseur modifié
        value:
            callback: getLastFournPriceFournName
    accountancy_code_buy_ue:
        label: Code Comptable Achat (Final UE)
        value:
            callback: 
                method: getCodeComptableAchat
                params:
                    - 2
    accountancy_code_buy_ex:
        label: Code Comptable Achat (Final Export)
        value:
            callback: 
                method: getCodeComptableAchat
                params:
                    - 3
                    
lists: 
    default: 
        title: Produits
        icon: fas_box
        checkboxes: 1
        configurable: 1
        bulk_actions:
            - label: étiquettes stock
              icon: fas_sticky-note
              onclick: setSelectedObjectsAction($(this), 'list_id', 'printEtiquettes', {'type':'stock'}, '', 'Générer les étiquettes ?', true)
            - label: étiquettes magasin
              icon: fas_sticky-note
              onclick: setSelectedObjectsAction($(this), 'list_id', 'printEtiquettes', {'type':'magasin'}, '', 'Générer les étiquettes ?', true)
        filters_panel: default
        sort_field: id
        sort_way: desc
        n: 50
        page_btn: 1
        edit_btn: 1
        edit_form: card
        add_form_name: card
        modal_view: default
        extra_btn: 
            callback: getListsButtons
        cols: 
            ref: 
            label: 
            fk_product_type: 
            barcode: 
            stock: 
            price: 
            tva_tx: 
            serialisable:
                
    inventory:
        extends: default
        add_btn: 0
        cols:
            fk_product_type: unset
            stock: unset
            price: unset
            tva_tx: unset
            
            nb_scanned:
                label: Nombre scanné
                value:
                    callback:
                        method: getNbScanned
                        params:
                            - 0
            stock_entrepot:
                show: 
                    callback:
                        method: canViewStock
                label: Stock
                value: 
                    callback: 
                        method: displayStockInventory
                        
    inventory_sr:
        extends: inventory
        cols:
            stock_entrepot: unset
            nb_scanned: unset
            nb_scanned_sr:
                label: Nombre scanné
                value:
                    callback:
                        method: getNbScanned
                        params:
                            - 1
            stock_sr:
                show: 
                    callback:
                        method: canViewStock
                label: Stock
                value: 
                    callback: 
                        method: displayStockInventorySr
                        
    inventory_stock:
        extends: default
        add_btn: 0
        sort_field: ref
        sort_way: asc
        cols:
            fk_product_type: unset
            stock: unset
            price: unset
            tva_tx: unset
            nb_scanned:
                label: Nombre scanné
                value:
                    callback: renderNbScanned
            stock_entrepot:
                show: 
                    callback:
                        method: canViewStock
                label: Stock
                value: 
                    callback: renderStock
                        
cards: 
    default: 
        view_btn: 1
        fields: 
            - field: ref
            - field: fk_product_type
            - field: price
            - field: tva_tx
            
    detailed: 
        view_btn: 1
        status: validate
        fields: 
            - field: ref
            - field: fk_product_type
            - field: barcode
            - field: price
            - field: tva_tx
            - field: serialisable
            
searches:
    default: 
        fields_search: 
            - a.label
            - a.ref
            - a.barcode
            - fp.ref_fourn
        joins:
            fp: 
                table: product_fournisseur_price
                on: a.rowid = fp.fk_product
                alias: fp
            fpl: 
                table: product_fournisseur_price
                on: a.rowid = fpl.fk_product AND fpl.fk_soc = 230880
                alias: fpl
        fields_return:
            - a.ref
            - a.label
            - REPLACE(ROUND(a.price,2),'.',',') as price
            - a.stock
            - fpl.stockFourn as stockFournL
        label_syntaxe: '<ref> - <label> - <price> € HT - Stock: [REDIFNEG]<stock>[/REDIFNEG] - Stock LDLC : <stockFournL>'
        
    tosell: 
        extends: default
        filters: 
            a.tosell: 1
            
    tobuy: 
        extends: default
        filters: 
            a.tobuy: 1
