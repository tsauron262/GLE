table: bs_sav
common_fields: 1

label: 
    name: SAV
    name_plur: SAV
    
objects: 
    client: 
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: 
                module: bimpcore
                name: Bimp_Societe
            id_object: 
                field_value: id_client
                
    client_contact:
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: 
                module: bimpcore
                name: Bimp_Contact
            id_object: 
                field_value: id_client_contact
                
    contrat:
        relation: hasOne
        delete: 0
        instance:
            dol_object: contrat
            id_object:
                field_value: id_contrat
        card: 
            title: 
                object_prop: ref
            view_btn: 1
                
fields: 
    id_client:
        label: Client
        type: id_object
        object: client
        input: 
            type: search_societe
            societe_type: customer
        display: 
            default:
                type: nom
            nom_url: 
                type: nom_url
                modal_view: client
                
    id_client_contact:
        label: Contact
        type: id_object
        object: client_contact
        values: 
            array: client_contacts
        display: 
            default:
                type: nom_url
        display_if:
            field_name: id_client
            hide_values: 0,
        depends_on: id_client
        
    id_contrat:
        label: Contrat
        type: id_object
        object: contrat
        required: 1    
        input: 
            type: search_list
            search_list:
                table: contrat c
                field_return_value: c.rowid
                field_return_label: c.ref
                join: societe s
                join_on: c.fk_soc s.rowid
                join_return_label: s.nom
                options:    
                    default:
                        label: Recherche par référence contrat
                        fields_search: c.ref,c.rowid
                        join: societe s
                        join_on: c.fk_soc = s.rowid
                        join_return_label: s.nom
                        help: Entrez la référence ou l'ID d'un contrat
                    by_client:
                        label: Recherche par client
                        fields_search: s.nom,s.code_client
                        join: societe s
                        join_on: c.fk_soc = s.rowid
                        join_return_label: s.nom
                        help: Entrez le nom ou le code d'un client
        sort_options:
            by_ref: 
                label: référence
                value:
                    join:
                        table: contrat
                        field_value: ref
                        field_on: rowid
        
    
        
