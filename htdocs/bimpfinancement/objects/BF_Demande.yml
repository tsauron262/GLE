table: bf_demande
controller: demande
icon: fas_comment-dollar
new_status_logs: 1

header_btn: 
    callback: getActionsButtons
header_list_name: default
header_edit_form: default

list_page_url: 
    controller: index
    
nom_url: 
    syntaxe: <ref>
    
labels:
    name: demande de location
    name_plur: demandes de location
    is_female: 1

objects:
    contact_client: 
        extends: contact
        instance: 
            id_object:
                field_value: id_contact_client
    
    supplier: 
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: 
                module: bimpcore
                name: Bimp_Fournisseur
            id_object: 
                field_value: id_supplier
                
    supplier_contact:
        extends: contact
        instance:
            id_object:
                field_value: id_supplier_contact
                
    user_resp: 
        extends: user
        instance: 
            id_object: 
                field_value: id_user_resp
        
    main_source: 
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: BF_DemandeSource
            id_object: 
                field_value: id_main_source
                
    signature_devis: 
        relation: hasOne
        delete: 1
        instance: 
            bimp_object: 
                module: bimpcore
                name: BimpSignature
            id_object: 
                field_value: id_signature_devis
            
    signature_contrat: 
        relation: hasOne
        delete: 1
        instance: 
            bimp_object: 
                module: bimpcore
                name: BimpSignature
            id_object: 
                field_value: id_signature_contrat

    signature_pvr:
        relation: hasOne
        delete: 1
        instance: 
            bimp_object: 
                module: bimpcore
                name: BimpSignature
            id_object: 
                field_value: id_signature_pvr
                
    facture_fin: 
        extends: facture
        instance: 
            id_object: 
                field_value: id_facture_fin
    
    facture_fourn: 
        extends: facture_fourn
        instance: 
            id_object: 
                field_value: id_facture_fourn
                
    facture_fourn_rev: 
        extends: facture_fourn
        instance: 
            id_object: 
                field_value: id_facture_fourn_rev
                
    facture_cli_rev: 
        extends: facture
        instance: 
            id_object: 
                field_value: id_facture_cli_rev
    
    sources: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: 
                module: bimpfinancement
                name: BF_DemandeSource
        
    lines: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BF_Line
            
    demandes_refinanceurs:
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BF_DemandeRefinanceur
            
    rents_except: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BF_RentExcept
            
    frais_divers:
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BF_FraisDivers
            
    frais_fournisseur:
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BF_FraisFournisseur

    files:
        instance:
            bimp_object:
                module: bimpcore
                name: BimpFile
        list: 
            filters:
                parent_module: bimpfinancement
                parent_object_name: BF_Demande
        add_form: 
            name: upload
            values:
                fields: 
                    parent_module: bimpfinancement
                    parent_object_name: BF_Demande

fields: 
    id_client:
        label: Client
        type: id_object
        object: client
        input:
            card: default
        create_form: light
        edit_form: default
        default_value: 0
            
    id_contact_client: 
        label: Contact client signataire
        type: id_object
        object: contact_client
        create_form: default
        create_form_values:
            fields: 
                fk_soc: 
                    field_value: id_client
        input: 
            type: select
            options: 
                array: clientContacts
        search: 
            input: 
                type: search_object
        depends_on: id_client
        display_if:
            field_name: id_client
            hide_values: 0,''
            
    contacts_livraisons: 
        label: Contacts livraison(s) / installation(s)
        type: items_list
        items_data_type: id_object
        object: contact
        items_braces: 1
        input: 
            type: select
            options: 
                array: clientContacts
            help: Laisser vide pour utiliser le contact signataire comme contact de livraison.
        depends_on: id_client
        display_if:
            field_name: id_client
            hide_values: 0,''
            
    id_supplier:
        label: Apporteur
        type: id_object
        object: supplier
        input: 
            card: default
        create_form: light
        edit_form: default
        default_value: 0
        
    id_supplier_contact:
        label: Contact apporteur
        type: id_object
        object: supplier_contact
        input: 
            type: select
            options:
                array: supplierContacts
        search: 
            input: 
                type: search_object
        display_if: 
            field_name: id_supplier
            hide_values: 0,''
        depends_on: id_supplier
        create_form: default
        create_form_values:
            fields: 
                fk_soc: 
                    field_value: id_supplier
                    
    commission_apporteur:
        label: Commission apporteur
        type: percent
        default_value: 0
        decimals: 2
        display_if: 
            field_name: id_supplier
            hide_values: 0,''
        depends_on: id_supplier
                    
    id_user_resp: 
        label: Responsable
        type: id_object
        object: user_resp
        input: 
            type: search_user
        default_value: 0
        
    id_main_source: 
        label: Source principale
        type: id_object
        object: main_source
        default_value: 0
        
    label: 
        label: Libellé
        
    ref: 
        label: Référence
        
    status:
        label: Statut
        type: int
        values: 
            array: status_list
        
    devis_status: 
        label: Statut Devis
        type: int
        values: 
            array: doc_status_list
        default_value: 0
        
    contrat_status: 
        label: Statut Contrat
        type: int
        values: 
            array: doc_status_list
        default_value: 0
        
    pvr_status: 
        label: Statut PVR
        type: int
        values: 
            array: doc_status_list
        default_value: 0
        
    duration:
        label: Durée (hors périodes suppl.)
        type: int
        values: 
            array: durations
        default_value:
            conf: 
                module: bimpfinancement
                name: def_duration
        
    periodicity: 
        label: Périodicité
        type: int
        values: 
            array: periodicities
        default_value: 
            conf: 
                module: bimpfinancement
                name: def_periodicity
            
    mode_calcul:
        label: Terme des paiements
        type: int
        values: 
            array: calc_modes
        default_value: 
            conf: 
                module: bimpfinancement
                name: def_mode_calcul
                
    mode_paiement: 
        label: Mode de paiement
        type: int
        values: 
            array: modes_paiements
        default_value: 1
            
    marge_souhaitee:
        label: Marge
        type: percent
        decimals: 2
        input: 
            extra_content: 
                callback: 
                    method: renderOptionInputExtraContent
                    params: 
                        - marge_souhaitee
        default_value:
            conf: 
                module: bimpfinancement
                name: def_marge_souhaitee
        
    def_tx_cession:
        label: Taux de cession par défaut
        values: 
            moyen: Taux moyen
            reel: Taux réel
        default_value: moyen
            
    tx_cession:
        label: Taux de cession annuel
        type: percent
        default_value: 0
        decimals: 8
        input: 
            extra_content: 
                callback: 
                    method: renderOptionInputExtraContent
                    params: 
                        - tx_cession
                        
    montant_materiels:
        label: Montant matériels HT
        type: money
        default_value: 0
        
    montant_services:
        label: Montant services HT
        type: money
        default_value: 0
                
    montant_logiciels:
        label: Montant logiciels HT
        type: money
        default_value: 0
        
    vr_achat: 
        label: VR achat
        type: percent
        input: 
            extra_content: 
                callback: 
                    method: renderOptionInputExtraContent
                    params: 
                        - vr_achat
        default_value:
            conf: 
                module: bimpfinancement
                name: def_vr_achat
            
    vr_vente: 
        label: VR vente
        type: percent
        input: 
            extra_content: 
                callback: 
                    method: renderOptionInputExtraContent
                    params: 
                        - vr_vente
        default_value:
            conf: 
                module: bimpfinancement
                name: def_vr_vente
        
    ca_prevu: 
        label: CA prévu
        type: money
        required: 0
        
    pba_prevu:
        label: PBA prévu
        type: money
        required: 0
            
    date_loyer:
        label: Date de mise en loyer
        type: date
        
    formule: 
        label: Formule choisie
        values: 
            array: formules
        default_value: none
            
    agreement_number:
        label: N° d'accord
    
    loyer_mensuel_evo_ht: 
        label: Loyer mensuel HT (form. évo) 
        type: money
        decimals: 3
        default_value: 0
        input: 
            extra_content: 
                callback: 
                    method: renderOptionInputExtraContent
                    params: 
                        - loyer_mensuel_evo_ht
        
    loyer_mensuel_dyn_ht: 
        label: Loyer mensuel HT (form. dyn) 
        type: money
        decimals: 3
        default_value: 0
        input: 
            extra_content: 
                callback: 
                    method: renderOptionInputExtraContent
                    params: 
                        - loyer_mensuel_dyn_ht
        
    loyer_mensuel_suppl_ht: 
        label: Loyer mensuel HT suppl. (form. dyn) 
        type: money
        decimals: 3
        default_value: 0
        input: 
            extra_content: 
                callback: 
                    method: renderOptionInputExtraContent
                    params: 
                        - loyer_mensuel_suppl_ht
        
    id_signature_devis: 
        label: Signature du devis
        type: id_object
        object: signature_devis
        default_value: 0
        
    signature_devis_params: 
        label: Paramètres signature du devis
        type: json
        
    id_signature_contrat: 
        label: Signature du contrat
        type: id_object
        object: signature_contrat
        default_value: 0
        
    signature_contrat_params: 
        label: Paramètres signature du contrat
        type: json
      
    contrat_signataires_data: 
        label: Données signataires contrat
        type: json
        
    id_signature_pvr: 
        label: Signature du PV de réception
        type: id_object
        object: signature_pvr
        
    signature_pvr_params: 
        label: Paramètres signature du pvr
        type: json
        
    pvr_signataires_data: 
        label: Données signataires PVR
        type: json
        
    closed: 
        label: Terminée
        type: bool
        default_value: 0
        
    id_facture_fourn:
        label: Facture Fournisseur
        type: id_object
        object: facture_fourn
        default_value: 0
        
    id_facture_fin: 
        label: Facture financeur
        type: id_object
        object: facture_fin
        default_value: 0      
        
    merged_demandes: 
        label: IDs des Demandes fusionnées
        type: items_list
        items_data_type: id
        items_braces: 1
        
    no_fac_fourn: 
        label: Pas de facture fournisseur
        type: bool
        default_value: 0
        
    no_fac_fin: 
        label: Pas de facture financeur
        type: bool
        default_value: 0
        
    id_facture_fourn_rev: 
        label: Facture fournisseur de rachat
        type: id_object
        object: facture_fourn_rev
        default_value: 0
        
    id_facture_cli_rev: 
        label: Facture client de revente
        type: id_object
        object: facture_cli_rev
        default_value: 0
        
    total_rachat_ht: 
        label: Total rachat HT
        type: money
        default_value: 0
        
forms:
    default: 
        rows: 
            resp: 
                field: id_user_resp
            label: 
                field: label
            client:    
                field: id_client
            contact: 
                field: id_contact_client
            contacts_livraisons: 
                field: contacts_livraisons
            supplier: 
                field: id_supplier
            contact_supplier: 
                field: id_supplier_contact
            commission_apporteur: 
                field: commission_apporteur
            duration: 
                field: duration
            periodicity: 
                field: periodicity
            mode_calcul: 
                field: mode_calcul
            def_tx_cession: 
                field: def_tx_cession
            date_loyer: 
                field: date_loyer
        
    proposition:
        rows: 
            - custom: 1
              label: Titre du document
              input_name: title
              value: Proposition de location de vos équipements informatiques
              input: 
                      type: text
            - field: montant_materiels
            - field: montant_services
            - field: duration
            - field: periodicity
            - field: mode_calcul
              
    cancel: 
        rows: 
            - custom: 1
              label: Raisons de l'abandon
              input_name: reasons
              data_type: text
              input: 
                  type: textarea
                  rows: 3
                  auto_expand: 1
                
    create_signature: 
        title: Création de la signature
        rows: 
            contact_signature: 
                custom: 1
                label: Contact signataire du client
                data_type: id_object
                input_name: id_contact_signature
                input: 
                    type: select
                    options: 
                        callback: 
                            method: getSocieteContactsArray
                            params: 
                                - field_value: id_client
                    help: 'Contact signataire obligatoire.<br/><b>Si aucun contact enregistré pour ce client, veuillez en créer un.</b>'
                value: 
                    callback: getDefaultSignatureContact
                    
            signature_type: 
                custom: 1
                label: Type de signature
                input_name: signature_type
                content:
                    callback: 
                        method: renderSignatureTypeSelect
                        
            email_content: 
                custom: 1
                label: Contenu e-mail client pour la signature à distance
                input_name: email_content
                input: 
                    type: html
                    help: "Vous pouvez utiliser les mot-clés: {NOM_DOCUMENT}, {NOM_PIECE} (le remplacement inclus l'article le / la / l'), {REF_PIECE} et {LIEN_ESPACE_CLIENT}.<br/>Le devis sera automatiquement joint à l'email"
                value: 
                    callback: 
                        method: getSignatureEmailContent
                depends_on: signature_type
    
    create_signature_devis: 
        extends: create_signature
        title: Création de la signature du devis
        rows: 
            signature_type: 
                content:
                    callback: 
                        params: 
                            - devis                            
            email_content:
                value: 
                    callback: 
                        params: 
                            - ''
                            - devis
                            
    create_signature_contrat: 
        extends: create_signature
        title: Création de la signature du contrat
        rows: 
            signature_type: 
                content:
                    callback: 
                        params: 
                            - contrat
            email_content:
                value: 
                    callback: 
                        params: 
                            - ''
                            - contrat
            
    create_signature_pvr: 
        extends: create_signature
        title: Création de la signature du PV de réception
        rows: 
            signature_type: 
                content:
                    callback: 
                        params: 
                            - pvr
            email_content:
                value: 
                    callback: 
                        params: 
                            - ''
                            - pvr
        
    generate_devis: 
        title: Création du devis de location
        rows: 
            - custom: 1
              label: Remplacer le (ou un des) devis généré(s)
              input_name: replace_devis
              data_type: bool
              input: 
                  type: toggle
              value: 0
              show: 
                  field_value: devis_status
            - custom: 1
              label: Devis à remplacer
              input_name: replaced_devis
              input: 
                  type: select
                  options: 
                      callback: getDevisFilesArray
              show: 
                  field_value: devis_status
              display_if: 
                  field_name: replace_devis
                  show_values: 1
            - custom: 1
              label: Formules à proposer
              input_name: formules
              input: 
                  type: check_list
                  items:
                      evo: Formule évolutive
                      dyn: Formule dynamique
              value: evo,dyn 
                      
    generate_contrat: 
        title: Création du contrat de location
        msgs: 
            callback: getContratFormMsgs
        rows: 
            - custom: 1
              label: Modèle
              input_name: type_pdf
              input: 
                  type: select
                  options: 
                      papier: Signature papier
                      elec: Signature électronique
              value: papier
            - field: formule
              required: 1
              
            # LOCATAIRE: 
            - title: Locataire
            - custom: 1
              label: Nom Client locataire
              input_name: client_name
              input: 
                  type: text
            - custom: 1
              label: Adresse e-mail du client
              input_name: client_email
              input: 
                  type: text
            - custom: 1
              label: Entreprise
              input_name: client_is_company
              input: 
                  type: toggle
            - custom: 1
              label: Forme juridique
              input_name: client_forme_juridique
              input: 
                  type: text
              display_if: 
                  field_name: client_is_company
                  show_values: 1
            - custom: 1
              label: Capital
              input_name: client_capital
              input: 
                  type: text
              display_if: 
                  field_name: client_is_company
                  show_values: 1      
            - custom: 1
              label: N° Siren
              input_name: client_siren
              input: 
                  type: text
              display_if: 
                  field_name: client_is_company
                  show_values: 1
            - custom: 1
              label: Enregistré à L'INSEE
              input_name: client_insee
              input: 
                  type: toggle
              value: 0
              display_if: 
                  field_name: client_is_company
                  show_values: 1
            - custom: 1
              label: Ville d'enregistrement au RCS
              input_name: client_rcs
              input: 
                  type: text
              display_if: 
                  fields_names: client_is_company,client_insee
                  client_is_company: 
                      show_values: 1
                  client_insee: 
                      hide_values: 1
            - custom: 1
              label: adresse / siège (si pro)
              input_name: client_address
              input: 
                  type: textarea
            - custom: 1
              label: Nom du représentant signataire
              input_name: client_representant
              input: 
                  type: text          
            - custom: 1
              label: Qualité du représentant signataire
              input_name: client_repr_qualite
              input: 
                  type: text
              display_if: 
                  field_name: client_is_company
                  show_values: 1
            - custom: 1
              label: Site(s) d'installation
              input: 
                  type: textarea
              input_name: client_livraisons
                  
            # LOUEUR: 
            - title: Loueur
            - custom: 1
              label: Nom loueur
              input_name: loueur_nom
              input: 
                  type: text
            - custom: 1
              label: Qualité loueur
              input_name: loueur_qualite
              input: 
                  type: text
            - custom: 1
              label: Adresse e-mail loueur
              input_name: loueur_email
              input: 
                  type: text
                  
            # CESSIONNAIRE: 
            - title: Cessionnaire
            - custom: 1
              label: Cessionnaire
              input_name: cessionnaire_id_refinanceur
              input: 
                  type: select
                  options: 
                      callback: 
                          method: getRefinanceursArray
                          params: 
                              - 1
                              - 1
                              - Non défini
            - custom: 1
              label: Raison sociale
              input_name: cessionnaire_saison_sociale
              input: 
                  type: text
              depends_on: cessionnaire_id_refinanceur
            - custom: 1
              label: N° SIREN
              input_name: cessionnaire_siren
              input: 
                  type: text
              depends_on: cessionnaire_id_refinanceur
            - custom: 1
              label: Contact signataire du refinanceur
              input_name: cessionnaire_id_contact_signataire
              data_type: id
              input: 
                  type: select
                  options: 
                      array: cessionnaireContacts
              depends_on: cessionnaire_id_refinanceur
            - custom: 1
              label: Nom Cessionnaire
              input_name: cessionnaire_nom
              input: 
                  type: text
              depends_on: cessionnaire_id_contact_signataire
            - custom: 1
              label: Adresse e-mail cessionnaire
              input_name: cessionnaire_email
              input: 
                  type: text
              depends_on: cessionnaire_id_contact_signataire
            - custom: 1
              label: Qualité cessionnaire
              input_name: cessionnaire_qualite
              input: 
                  type: text
              depends_on: cessionnaire_id_contact_signataire
              
    generate_pvr: 
        rows: 
            # LOCATAIRE: 
            - title: Locataire
            - custom: 1
              label: Entreprise
              input_name: client_is_company
              input: 
                  type: toggle
            - custom: 1
              label: Nom du représentant signataire
              input_name: client_representant
              input: 
                  type: text          
            - custom: 1
              label: Qualité du représentant signataire
              input_name: client_repr_qualite
              input: 
                  type: text
              display_if: 
                  field_name: client_is_company
                  show_values: 1
                  
            # LOUEUR: 
            - title: Loueur
            - custom: 1
              label: Nom loueur
              input_name: loueur_nom
              input: 
                  type: text
            - custom: 1
              label: Qualité loueur
              input_name: loueur_qualite
              input: 
                  type: text
            - custom: 1
              label: Adresse e-mail loueur
              input_name: loueur_email
              input: 
                  type: text
                  
    upload_document:
        rows: 
            file: 
                custom: 1
                label: Fichier
                input_name: doc_file
                input: 
                    type: file_upload  
                    help: Format PDF uniquement
            flag: 
                custom: 1
                hidden: 1
                label: Dépôt doc
                input_name: updload_doc_type
                input: 
                    type: hidden
            replace: 
                custom: 1
                label: Remplacer le (ou un des) devis généré(s)
                input_name: replace_devis
                data_type: bool
                input: 
                    type: toggle
                value: 0
                show: 
                    field_value: devis_status
            replaced: 
                custom: 1
                label: Devis à remplacer
                input_name: replaced_devis
                input: 
                    type: select
                    options: 
                        callback: getDevisFilesArray
                display_if: 
                    field_name: replace_devis
                    show_values: 1
        
    upload_devis: 
        extends: upload_document
        rows: 
            flag: 
                value: devis
                
    upload_contrat: 
        extends: upload_document
        rows: 
            flag: 
                value: contrat
                
    submit_new_status: 
        msgs: 
          - type: warning
        rows: 
          - custom: 1
            label: Notes à l'intention du commercial 
            input_name: note
            input: 
                type: textarea
                rows: 3
                auto_expand: 1
                
    submit_refuse: 
        extends: submit_new_status
        msgs: 
            0: 
                content: '<b>Attention: refus définitif - la demande sera fermée</b>'
                
    submit_cancel: 
        extends: submit_new_status
        msgs: 
            0: 
                content: '<b>Attention: abandon définitif - la demande sera fermée</b>'
                
    merge_demandes: 
        msgs: 
            callback: getDemandesToMergeErrorsMsgs
        rows: 
            - custom: 1
              label: Source principale
              input_name: id_main_source
              data_type: id
              required: 1
              input: 
                  type: select
                  options: 
                      array: demandesSources
                  help: Sélectionnez la source qui sera en charge de transmettre au client les documents à signer.<br/>Ce sera la demande de location correspondant à cette source qui sera conservée.
                
    factures:
        title: Facturation
        msgs: 
            callback: getFacturesFormMsgs
        rows:
          - title: Facture Fournisseur
          - custom: 1
            label: Créer la facture fournisseur
            input_name: create_fac_fourn
            data_type: bool
            content: 
                callback: renderCreateFacFournToggleInput
          - custom: 1
            label: Fournisseur
            input_name: fac_fourn_id_fourn
            data_type: id_object
            object: fournisseur
            input: 
                type: search_object
                card: default
            display_if: 
                field_name: create_fac_fourn
                show_values: 1
          - custom: 1
            label: Libellé
            input_name: fac_fourn_libelle
            input: 
                type: text
            display_if: 
                field_name: create_fac_fourn
                show_values: 1
          - custom: 1
            label: Ref. fournisseur
            input_name: fac_fourn_ref_supplier
            input: 
                type: text
            display_if: 
                field_name: create_fac_fourn
                show_values: 1
          - custom: 1
            label: Mode de réglement
            input_name: fac_fourn_id_mode_reglement
            data_type: id
            input: 
                type: select
                options: 
                    callback: 
                        method: getModeReglementsArray
                        params: 
                            - id
                            - 1
            display_if: 
                field_name: create_fac_fourn
                show_values: 1
          - custom: 1
            label: Conditions de réglement
            input_name: fac_fourn_id_cond_reglement
            data_type: id
            input: 
                type: select
                options: 
                    callback: getCondReglementsArray
            display_if: 
                field_name: create_fac_fourn
                show_values: 1
          - title: Facture client (financeur)
          - custom: 1
            label: Créer la facture client
            input_name: create_fac_fin
            data_type: bool
            content: 
                callback: renderCreateFacFinToggleInput
          - custom: 1
            label: Client
            input_name: fac_fin_id_client
            data_type: id_object
            object: client
            input: 
                type: search_object
                card: default
            display_if: 
                field_name: create_fac_fin
                show_values: 1
          - custom: 1
            label: Libellé
            input_name: fac_fin_libelle
            input: 
                type: text
            display_if: 
                field_name: create_fac_fin
                show_values: 1
          - custom: 1
            label: Mode de réglement
            input_name: fac_fin_id_mode_reglement
            data_type: id
            input: 
                type: select
                options: 
                    callback: 
                        method: getModeReglementsArray
                        params: 
                            - id
                            - 1
            display_if: 
                field_name: create_fac_fin
                show_values: 1
          - custom: 1
            label: Conditions de réglement
            input_name: fac_fin_id_cond_reglement
            data_type: id
            input: 
                type: select
                options: 
                    callback: getCondReglementsArray
            display_if: 
                field_name: create_fac_fin
                show_values: 1
                
    force_fin_contrat: 
        rows: 
            - field: date_loyer
              required: 1
            - custom: 1
              label: Refinanceur
              input_name: id_refinanceur
              data_type: id
              input: 
                  type: select
                  options: 
                      callback: getRefinanceursArray
              required: 1
            - custom: 1
              label: Factures
              input_name: factures
              input: 
                  type: check_list
                  items: 
                      fac_fourn: Facture fournisseur déjà établie
                      fac_fin: Facture financeur déjà établie
              value: fac_fourn,fac_fin
            - custom: 1
              label: Prix de cession total HT
              input_name: prix_cession_ht
              required: 1
              data_type: money
              input: 
                  type: text                
                  
    factures_revente: 
        title: Facturation revente
        msgs: 
            callback: getFacturesFormMsgs
        rows:
          - field: total_rachat_ht
          - field: vr_vente
          - title: Facture Fournisseur de rachat au financeur 
          - custom: 1
            label: Créer la facture fournisseur
            input_name: create_fac_fourn_rev
            data_type: bool
            content: 
                callback: renderCreateFacFournReventeToggleInput
          - custom: 1
            label: Fournisseur
            input_name: fac_fourn_rev_id_fourn
            data_type: id_object
            object: fournisseur
            input: 
                type: search_object
                card: default
            display_if: 
                field_name: create_fac_fourn_rev
                show_values: 1
          - custom: 1
            label: Libellé
            input_name: fac_fourn_rev_libelle
            input: 
                type: text
            display_if: 
                field_name: create_fac_fourn_rev
                show_values: 1
          - custom: 1
            label: Ref. fournisseur
            input_name: fac_fourn_rev_ref_supplier
            input: 
                type: text
            display_if: 
                field_name: create_fac_fourn_rev
                show_values: 1
          - custom: 1
            label: Mode de réglement
            input_name: fac_fourn_rev_id_mode_reglement
            data_type: id
            input: 
                type: select
                options: 
                    callback: 
                        method: getModeReglementsArray
                        params: 
                            - id
                            - 1
            display_if: 
                field_name: create_fac_fourn_rev
                show_values: 1
            depends_on: fac_fourn_rev_id_fourn
          - custom: 1
            label: Conditions de réglement
            input_name: fac_fourn_rev_id_cond_reglement
            data_type: id
            input: 
                type: select
                options: 
                    callback: getCondReglementsArray
            display_if: 
                field_name: create_fac_fourn_rev
                show_values: 1
            depends_on: fac_fourn_rev_id_fourn
          - title: Facture de revente au client
          - custom: 1
            label: Créer la facture client de revente
            input_name: create_fac_cli_rev
            data_type: bool
            content: 
                callback: renderCreateFacCliReventeToggleInput
          - custom: 1
            label: Client
            input_name: fac_cli_rev_id_client
            data_type: id_object
            object: client
            input: 
                type: search_object
                card: default
            display_if: 
                field_name: create_fac_cli_rev
                show_values: 1
          - custom: 1
            label: Libellé
            input_name: fac_cli_rev_libelle
            input: 
                type: text
            display_if: 
                field_name: create_fac_cli_rev
                show_values: 1
          - custom: 1
            label: Mode de réglement
            input_name: fac_cli_rev_id_mode_reglement
            data_type: id
            input: 
                type: select
                options: 
                    callback: 
                        method: getModeReglementsArray
                        params: 
                            - id
                            - 1
            display_if: 
                field_name: create_fac_cli_rev
                show_values: 1
            depends_on: fac_cli_rev_id_client
          - custom: 1
            label: Conditions de réglement
            input_name: fac_cli_rev_id_cond_reglement
            data_type: id
            input: 
                type: select
                options: 
                    callback: getCondReglementsArray
            display_if: 
                field_name: create_fac_cli_rev
                show_values: 1
            depends_on: fac_cli_rev_id_client
                
fields_tables:
    infos: 
        title: Infos
        icon: fas_info-circle
        rows: 
            - field: id_user_resp
            - field: date_loyer
              edit: 1
            - field: agreement_number
              edit: 1
            - field: id_client
              display: card
              show: 
                  field_value: id_client
            - field: id_contact_client
              display: card
              show: 
                  field_value: id_contact_client
            - field: contacts_livraisons
            - field: id_supplier
              display: card
              show: 
                  field_value: id_supplier
            - field: id_supplier_contact
              display: card
              show: 
                  field_value: id_supplier_contact
    
    options: 
        title: Options
        icon: fas_check-square
        rows: 
            - field: duration
              label: Durée<br/><span class="small">(hors loyers suppl.)</span>
              edit: 1
            - field: periodicity
              edit: 1
            - field: mode_calcul
              edit: 1 
            - field: mode_paiement
              edit: 1
            - field: vr_achat
              edit: 1
            - field: marge_souhaitee
              edit: 1
            - field: def_tx_cession
              edit: 1
            - field: tx_cession
              edit: 1
            - field: formule
              label: Formule choisie par le client
              edit: 1
              
    montants: 
        title: Montants
        icon: euro
        rows:
            - field: montant_materiels
            - field: montant_services
            - field: montant_logiciels
            - label: Total demande HT
              value: 
                  callback: displayTotalDemande        
            - field: loyer_mensuel_evo_ht
              edit: 1
              show: 
                  callback: showLoyers
            - field: loyer_mensuel_dyn_ht
              edit: 1
              show: 
                  callback: showLoyers
            - field: loyer_mensuel_suppl_ht
              edit: 1
              show: 
                  callback: showLoyers
                  
    signatures: 
        title: Signatures
        icon: fas_signature
        rows: 
            - field: id_signature_devis
              display: card
              show: 
                  field_value: id_signature_devis
            - field: id_signature_contrat
              display: card
              show: 
                  field_value: id_signature_contrat
            - field: id_signature_pvr
              display: card
              show: 
                  field_value: id_signature_pvr
                  
    factures: 
        title: Factures
        icon: fas_file-invoice-dollar
        rows: 
            - field: id_facture_fourn
              display: card
            - field: id_facture_fin
              display: card
    
    options_revente: 
        title: Options revente
        icon: fas_check-square
        rows: 
            - field: total_rachat_ht
              edit: 1
            - field: vr_vente
              edit: 1
              
    factures_revente: 
        title: Facturation revente
        icon: fas_file-invoice-dollar
        rows: 
            - field: id_facture_fourn_rev
              display: card
            - field: id_facture_cli_rev
              display: card
        
views:
    default: 
        title: nom
        edit_form: default
        objects_change_reload: BF_DemandeRefinanceur,BF_Line,BimpSignature,BimpFile
        rows:
            0: 
                cols: 
                    - type: object_header
            1: 
                cols: 
                    - type: fields_table
                      col_lg: 6
                      col_md: 6
                      fields_table:
                          name: infos
                          
                    - type: fields_table
                      col_lg: 6
                      col_md: 6
                      show: 
                          callback: hasFacture
                      fields_table:
                          name: factures
                          
                    - type: fields_table
                      col_lg: 6
                      col_md: 6
                      show: 
                          callback: hasSignature
                      fields_table:
                          name: signatures
    
    demande: 
        extends: default
        rows: 
            0: unset
            
    montants: 
        panel: 0
        objects_change_reload: BF_DemandeRefinanceur,BF_Line,BimpSignature
        rows: 
            - cols: 
                - type: fields_table
                  col_md: 6
                  col_lg: 6
                  fields_table: 
                      name: options
                      
                - type: rows
                  col_md: 6
                  col_lg: 6
                  rows: 
                      - cols: 
                          - type: fields_table
                            fields_table: 
                                name: montants
            - cols: 
                - type: custom
                  custom: 
                      callback: renderCalcValues
        
    revente: 
        panel: 0
        objects_change_reload: BF_DemandeRefinanceur,BF_Line,BimpSignature
        rows: 
            - cols: 
                - type: fields_table
                  col_md: 6
                  col_lg: 6
                  fields_table: 
                      name: options_revente
                      
                - type: fields_table
                  col_md: 6
                  col_lg: 6
                  show: 
                        callback: hasFactureRevente
                  fields_table: 
                      name: factures_revente
            
filters_panels: 
    default: 
        filters: 
            status: 
            devis_status: 
            contrat_status: 
            ref: 
            date_create: 
            id_client: 
            id_user_resp: 
                
lists_cols: 
    id: 
        label: ID
        
    client: 
        label: Client
        value: 
            callback: displayClient
        search: 
            type: value_part
    total:        
        label: Total demande HT
        value: 
              callback: displayTotalDemande  
        
lists:
    default:
        checkboxes: 1
        configurable: 1
        filters_panel: default
        bulk_actions:
            - label: supprimer les demandes de fincancement sélectionnées
              icon: fas_trash-alt
              onclick: deleteSelectedObjects('list_id', $(this))
        extra_bulk_actions: 
            callback: getListExtraBulkActions
        header_buttons: 
            callback: getDefaultListHeaderButton
        sort_field: date_create
        sort_way: desc
        n: 10
        add_form_name: default
        delete_btn: 1
        page_btn: 1
        modal_view: demande
        edit_btn: 1
        edit_form: default
        delete_btn: 1
        extra_btn: 
            callback: getListExtraButtons
        cols:
            ref: 
            date_create:
            label: 
            id_user_resp: 
            client: 
            status:
            devis_status: 
            contrat_status: 

signatures: 
    devis: 
        label: Devis de location
    contrat: 
        label: Contrat de location
    pvr: 
        label: PV de réception