extends: 
    module: bimpcommercial
    object_name: Bimp_PropalLine

table: bs_sav_propal_line

parent_module: bimpsupport
parent_object: BS_SavPropal

labels: 
    name: ligne du devis
    name_plur: lignes du devis
    is_female: 1
    
objects: 
    reservation: 
        delete: 1
                
fields: 
    id_reservation: 
        label: Réservation
        type: id_object
        object: reservation
        input: 
            type: hidden
        default_value: 0
        
    out_of_warranty:
        label: Hors garantie
        type: bool
        default_value: 1
        display_if:
            field_name: type
            show_values: 1
            
    def_pu_ht: 
        label: PU HT par défaut
        type: money
        default_value: 0
        
    def_tva_tx:
        label: Taux de TVA par défaut
        type: percent
        default_value: 0
        
    def_id_fourn_price:
        label: Prix fournisseur par défaut
        type: int
        default_value: 0
        
    abo_fac_periodicity: unset
    abo_duration: unset
    abo_fac_term: unset
    abo_nb_renouv: unset
        
forms: 
    sav: 
        values: 
            objects: 
                remises: 
                    callback: getClientDefaultRemiseFormValues
        rows: 
            - field: type
              hidden: 
                  field_value: id
            
            - custom: 1
              label: Produit
              value: 
                  callback: getIdProductFromPost
              input_name: id_product
              content: 
                  callback: 
                      method: renderLineInput
                      params: 
                          - id_product
              display_if: 
                  fields_names: type,id_equipment
                  type: 
                      hide_values: 2
                  id_equipment: 
                      show_values: 0,
              depends_on: id_equipment
              show:
                  callback: isProductEditable
              
            - custom: 1
              label: Equipement
              input_name: id_equipment
              data_type: int
              input: 
                  type: search_list
                  search_list:
                      table: be_equipment e
                      field_return_value: e.id
                      field_return_label: e.serial
                      fields_search: e.serial,e.id,e.product_label
                  help: Numéro de série ou ID d'un équipement
              show:
                  callback: isProductEditable
              display_if: 
                  field_name: type
                  hide_values: 2
            
            - custom: 1
              label: Prix unitaire HT
              value: 
                  prop: pu_ht
              input_name: pu_ht
              content: 
                  callback: 
                      method: renderLineInput
                      params: 
                          - pu_ht
              display_if: 
                  field_name: type
                  show_values: 1
              depends_on: id_product,id_equipment
              
            - custom: 1
              label: Taux de TVA
              value: 
                  prop: tva_tx
              input_name: tva_tx
              content: 
                  callback: 
                      method: renderLineInput
                      params: 
                          - tva_tx
              display_if: 
                  field_name: type
                  show_values: 1
              depends_on: id_product,id_equipment
              
            - custom: 1
              label: Quantité
              value: 
                  prop: qty
              input_name: qty
              content: 
                  callback: 
                      method: renderLineInput
                      params: 
                          - qty
              display_if: 
                  field_name: type
                  show_values: 1
              depends_on: id_product,id_equipment
                  
#            - custom: 1
#              label: Remise
#              value: 
#                  prop: remise
#              input_name: remise
#              content: 
#                  callback: 
#                      method: renderLineInput
#                      params: 
#                          - remise
#              display_if: 
#                  field_name: type
#                  show_values: 1
                  
            - field: out_of_warranty
            
            - custom: 1
              label: Prix d'achat
              input_name: id_fourn_price
              data_type: id_object
              object: fournisseur_price
              content: 
                  callback: 
                      method: renderLineInput
                      params: 
                          - id_fourn_price
              display_if: 
                  field_name: type
                  show_values: 1
              depends_on: id_product,id_equipment
              create_form: 
                  callback: getFournisseurPriceCreateForm
              create_form_values: 
                  fields: 
                      fk_product: 
                          callback: getIdProductFromPost
              value: 
                  callback: getIdFournPriceFromPost
                  
            - custom: 1
              label: Marges
              input_name: margins_table
              content: 
                  callback: renderFormMargins
              display_if: 
                  field_name: type
                  hide_values: 2
                  
            - custom: 1
              label: Description
              value: 
                  prop: desc
              input_name: desc
              content: 
                  callback: 
                      method: renderLineInput
                      params: 
                          - desc
                        
            - custom: 1
              label: Remises autorisées
              input_name: remisable
              content: 
                  callback: 
                      method: renderLineInput
                      params:
                          - remisable
              depends_on: id_product
              display_if: 
                  field_name: type
                  show_values: 1
              
            - object: remises
              multiple: 1
              form_values: 
                  fields: 
                      object_type: 
                          callback: getParentCommType
              display_if: 
                  fields_names: type,remisable
                  type: 
                      show_values: 1
                  remisable: 
                      hide_values: 0
              show: 
                  callback: isNotLoaded
                
    apple_part:
        rows: 
            - custom: 1
              label: Description
              value: 
                  prop: desc
              input_name: desc
              content: 
                  callback: 
                      method: renderLineInput
                      params: 
                          - desc
            - custom: 1
              label: Remises autorisées
              input_name: remisable
              content: 
                  callback: 
                      method: renderLineInput
                      params:
                          - remisable
                      
lists: 
    default: 
        objects_change_reload: BS_SAV,BS_SavPropal,BS_ApplePart,ObjectLineRemise,BS_Issue,GSX_Repair
        add_form_name: sav
        edit_form: 
            callback: getListEditForm
        header_buttons:
            callback: 
                method: getLinesListHeaderExtraBtn
                object: 
                    callback: getParentInstance
        cols: 
            out_of_warranty: 
                edit: 
                    callback: isWarrantyEditable
                item_show: 
                    callback: showWarranty
