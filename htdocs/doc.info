

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `llx_fichinter` AS (select `rowid` AS `rowid`,`fk_soc` AS `fk_soc`,`fk_projet` AS `fk_projet`,`fk_contrat` AS `fk_contrat`,`ref` AS `ref`,1 AS `entity`,`tms` AS `tms`,`datec` AS `datec`,`date_valid` AS `date_valid`,`datei` AS `datei`,`fk_user_author` AS `fk_user_author`,`fk_user_valid` AS `fk_user_valid`,`fk_statut` AS `fk_statut`,`duree` AS `duree`,`description` AS `description`,`note_private` AS `note_private`,`note_public` AS `note_public`,`model_pdf` AS `model_pdf`,'' AS `extraparams` from `llx_Synopsis_fichinter` where 1);


CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW 
llx_Synopsis_fichinter as (SELECT f.`rowid`, `fk_soc`, `fk_projet`, `fk_contrat`, `fk_commande`, `ref`, `tms`, `datec`, `date_valid`, `datei`, `fk_user_author`, `fk_user_valid`, `fk_statut`, `duree`, `description`, `note_private`, `note_public`, `model_pdf`, `total_ht`, `total_tva`, `total_ttc`, `natureInter`, `entity` 
FROM llx_fichinter f left join llx_synopsisfichinter sf on f.rowid = sf.rowid);

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW llx_Synopsis_fichinterdet as (SELECT f.`rowid`, `fk_fichinter`, `date`, `description`, `duree`, `rang`, `fk_typeinterv`, `fk_depProduct`, `tx_tva`, `pu_ht`, `qte`, `total_ht`, `total_tva`, `total_ttc`, `fk_contratdet`, `fk_commandedet`, `isForfait` 
FROM llx_fichinterdet f  left join llx_synopsisfichinterdet sf on f.rowid = sf.rowid);

CREATE TABLE IF NOT EXISTS `llx_fichinter` (
  `rowid` int(11) NOT NULL AUTO_INCREMENT,
  `fk_soc` int(11) NOT NULL,
  `fk_projet` int(11) DEFAULT '0',
  `fk_contrat` int(11) DEFAULT '0',
  `ref` varchar(30) NOT NULL,
  `entity` int(11) NOT NULL DEFAULT '1',
  `tms` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `datec` datetime DEFAULT NULL,
  `date_valid` datetime DEFAULT NULL,
  `datei` date DEFAULT NULL,
  `fk_user_author` int(11) DEFAULT NULL,
  `fk_user_valid` int(11) DEFAULT NULL,
  `fk_statut` smallint(6) DEFAULT '0',
  `duree` double DEFAULT NULL,
  `description` text,
  `note_private` text,
  `note_public` text,
  `model_pdf` varchar(255) DEFAULT NULL,
  `extraparams` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`rowid`),
  UNIQUE KEY `uk_fichinter_ref` (`ref`,`entity`),
  KEY `idx_fichinter_fk_soc` (`fk_soc`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;


CREATE TABLE IF NOT EXISTS `llx_fichinterdet` (
  `rowid` int(11) NOT NULL AUTO_INCREMENT,
  `fk_fichinter` int(11) DEFAULT NULL,
  `fk_parent_line` int(11) DEFAULT NULL,
  `date` datetime DEFAULT NULL,
  `description` text,
  `duree` int(11) DEFAULT NULL,
  `rang` int(11) DEFAULT '0',
  PRIMARY KEY (`rowid`),
  KEY `idx_fichinterdet_fk_fichinter` (`fk_fichinter`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;


















BIMP
INSERT INTO  `synopsis_bimp`.`llx_document_model` (
`rowid` ,
`nom` ,
`entity` ,
`type` ,
`libelle` ,
`description`
)
VALUES (
NULL ,  'azur_annexe',  '1',  'propal', NULL , NULL
);



INSTALLATION SUR NEW VERSION DOLIBARR :{
    Renommer projet => 1projet
    renommer fichinter => 1fichinter
    renommer main.inc.php => 1main.inc.php
    renommer core/modules/fichinter => 1fichinter


    Copier 
    Synopsis et babel dans
    -/
    -/admin
    -/core/modules/ (fichier + dossier)
    -/core/lib/ 

    --
    + Exception a copier egalement
    --

    /core/modules/moddemendeInterv.class.php
    /core/modules/contratGA
    /core/modules/contratGMAO
    /core/modules/demendeInterv
    /core/modules/fichinter *

    /core/lib/synopsisdemandeinterv.lib.php
    /core/lib/task.class.php //Louche pas de class ici normalement

    /fichinter *
    /projet *

    * Remplacemnt des fichier d'origine X3




 //Refactoring coeur
require\([a-zA-z0-9/."'_-]*.class.php   Pour rajouter _once
}


Parametrage :
    - conf/conf.php
    - Synopsis_Hrm/orange/lib/confs/Conf.php (Pour gestion ressources humaine)
Zimbra
    - dans le compte admin tous les contacte a partager avec qui on veut
    - chaque utilisateur responsable de ressource peut partager le calandrier de la ressource (dans l'avenir l'admin aussi)




MODIFICATION DU COEUR {
    - main.inc.php (Pour ajouter les hook synopsis + modif du path)
    - societe | societe.class.php (aj de $option = "customer"; ln 1244 pour arriver directement dans l'onglet client ou prospect)
    - propal | capsim : ajout du chrono dans la fiche propal
    - proopal | capsim : pas de ref brouillon propal.class
}




Creation des vue pour install 2 avec base client commune : {
    CREATE VIEW gle2_societe_address as SELECT * FROM gle1_societe_address;
    CREATE VIEW gle2_societe as SELECT * FROM gle1_societe;
    CREATE VIEW gle2_societe_commerciaux as SELECT * FROM gle1_societe_commerciaux;
    CREATE VIEW gle2_societe_extrafields as SELECT * FROM gle1_societe_extrafields;
    CREATE VIEW gle2_societe_log as SELECT * FROM gle1_societe_log;
    CREATE VIEW gle2_societe_prices as SELECT * FROM gle1_societe_prices;
    CREATE VIEW gle2_societe_remise as SELECT * FROM gle1_societe_remise;
    CREATE VIEW gle2_societe_remise_except as SELECT * FROM gle1_societe_remise_except;
    CREATE VIEW gle2_societe_rib as SELECT * FROM gle1_societe_rib;
}






