table: br_reservation_shipment
common_fields: 0

parent_object: BR_CommandeShipment
parent_id_property: id_shipment

labels: 
    name: ligne d'expédition
    name_plur: lignes d'expédition
    is_female: 1
    
objects:
    shipment: 
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: BR_CommandeShipment
            id_object: 
                field_value: id_shipment
                
fields: 
    id_shipment: 
        label: Expédition
        type: id_object
        object: shipment
        values: 
            array: shipments
        required: 1
        
    id_commande_client: 
        label: Commande client
        type: id
        
    id_commande_client_line:
        label: Ligne de la commande client
        type: id
        
    ref_reservation:
        label: Référence réservation
        required: 1
    
    id_product:
        label: Produit
        type: id_object
        object: product
        
    id_equipment:
        label: Equipement
        type: id_object
        object: equipment
        input: 
            type: hidden
        
    qty: 
        label: Quantité
        type: qty
        min: 0
        unsigned: 1
        max: 
            callback: getAvailableQty
                    
    group_articles: 
        label: Produits groupés
        type: bool
        default_value: 0
        display_if: 
            field_name: qty
            hide_values: 0,1
        input: 
            help: Si oui, une seule étiquette sera générée
        
forms: 
    default: 
        rows: 
            - field: ref_reservation
              hidden: 1
            - field: id_equipment
              hidden: 1
            - field: id_shipment
              create_form: default
              create_form_values: 
                  fields: 
                      id_commande_client: 
                          field_value: id_commande_client
            - field: qty
            - field: group_articles
            
    remove: 
        title: Retrait de l\'expédition
        rows: 
            - custom: 1
              label: Qté à retirer
              input_name: qty
              data_type: qty
              content: 
                  callback: renderRemoveQtyInput
            - custom: 1
              label: Retirer de la commande client
              data_type: bool
              input_name: remove_from_order
              value: 0
              input: 
                  type: toggle
            - custom: 1
              label: Produit défectueux
              data_type: bool
              input_name: defective
              value: 0
              input: 
                  type: toggle
              display_if: 
                  field_name: remove_from_order
                  show_values: 1
            - custom: 1
              label: Afficher sélection avoirs
              input_name: show_avoirs
              hidden: 1
              input: 
                  type: hidden
              value: 
                  callback: doAddToCreditNoteOnRemove    
              depends_on: remove_from_order
            - custom: 1
              label: Avoir
              input_name: id_avoir
              data_type: int
              input: 
                  type: select
                  options: 
                      array: avoirs
                  select_first: 1
              display_if: 
                  field_name: show_avoirs
                  show_values: 1
                                
lists: 
    default: 
        title: Liste des produits inclus dans l'expédition
        enable_search: 0
        sort_field: id
        sort_way: asc
        n: 10
        update_btn: 1
        extra_btn: 
            callback: getListExtraBtn
        cols:
            ref: 
                field: ref_reservation
            id_product: 
                field: id_product
                display: nom_url
            equipment: 
                field: id_equipment
                display: nom_url
            qty:
                field: qty
                edit: 
                    callback: isQtyEditable
            group: 
                field: group_articles
                edit:
                    callback: isEditable