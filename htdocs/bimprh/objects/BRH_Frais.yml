table: bnf_frais
icon: fas_sticky-note
controller: note

labels: 
    name: note de frais
    name_plur: notes de frais
    is_female: 1
    
objects:                 
    montants: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BRH_FraisMontant

    invite:
        relation: hasMany
        delete: 1
        instance:
            bimp_object: BRH_FraisInvite

    comment: 
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BRH_Comment
            
    kilometers:
        relation: hasMany
        delete: 1
        instance: 
            bimp_object: BRH_FraisKilometers

    files:
        instance:
            bimp_object:
                module: bimpcore
                name: BimpFile
        list: 
            filters:
                parent_module: bimprh
                parent_object_name: BRH_Frais
        add_form: 
            name: upload
            values:
                fields: 
                    parent_module: bimprh
                    parent_object_name: BRH_Frais
           
fields: 
    id_user: 
        label: Utilisateur
        type: id_object
        object: user
        input: 
            type: search_user
        defaul_value: 
            prop: 
                name: id
                object: 
                    global: user

    type: 
        label: Type
        type: int
        values: 
            array: types
        required: 1
        
    date: 
        label: Date
        type: date
        required: 1
        
    description: 
        label: Description
        type: text
        input: 
            auto_expand: 1
            rows: 1     
        
    status: 
        label: Statut
        type: int
        values: 
            array: status_list
        default_value: 1
        
    ticket_validated: 
        label: Tickets de caisse validé
        type: bool     
        
    period: 
        label: Période
        type: int
        values: 
            array: periods
        display_if:
            field_name: type
            show_values: 1
      
forms: 
    default: 
        rows: 
            - field: id_user
            - field: date
            - field: type
              input:
                    type: hidden
            - field: description
            # - field: period
            #   display_if: 
            #       field_name: type
            #       show_values: 1
            # - object: montants
            #   multiple: 1
            #   display_if: 
            #       field_name: type
            #       hide_values: 5
            # - object: kilometers
            #   multiple: 1
            #   display_if: 
            #       field_name: type
            #       show_values: 5
            
fields_tables: 
    default: 
        panel: 0
        rows: 
            - field: date
            - field: status
            - label: Total TTC
              value: 
                  callback: displayTotalAmount
            - field: id_user
              display: card
            #- field: period
            #  show: 
            #      callback: hasPeriod
            - field: type
            - field: description
            - field: ticket_validated


views: 
    default:
        objects_change_reload: BRH_FraisMontant,BRH_FraisKilometers
        rows: 
            - cols: 
                - type: object_header
            - cols: 
                - type: fields_table
                  fields_table: 
                      name: default
            - cols: 
                - type: list
                  show: 
                      callback: hasAmounts
                  list: 
                      children: montants
            - cols: 
                - type: list
                  show: 
                      callback: hasRestauration
                  list: 
                      children: invite
            - cols: 
                - type: list
                  show: 
                      callback: hasKilometers
                  list: 
                      children: kilometers
            - cols: 
                - type: list
                  list: 
                      children: files
lists: 
    default: 
        title: Notes de frais
        checkboxes: 1
        objects_change_reload: BRH_FraisMontant,BRH_FraisKilometers
        bulk_actions:
            callback: getListBulkActions
        list_filters: 
            callback: getListFilters
        sort_field: date_create
        sort_way: desc
        n: 10
        add_form_name: default
        edit_btn: 1
        edit_form: default
        page_btn: 1
        update_btn: 1
        delete_btn: 1
        modal_view: default
        extra_btn: 
            callback: getListExtraBtn
        cols:
            date: 
                field: date
            user: 
                field: id_user
                display: nom_url
            type: 
                field: type
            amount: 
                label: Total TTC
                value: 
                    callback: displayTotalAmount
            ticket: 
                field: ticket_validated
                edit: 1
            status: 
                field: status
    
    user: 
        title: Notes de frais
        checkboxes: 1
        objects_change_reload: BRH_FraisMontant,BRH_FraisKilometers
        bulk_actions:
            callback: getListBulkActions
        list_filters: 
            callback: getListFilters
        sort_field: date_create
        sort_way: desc
        n: 10
        add_form_name: default
        edit_btn: 1
        edit_form: default
        update_btn: 1
        delete_btn: 1
        modal_view: default
        extra_btn: 
            callback: getListExtraBtn
        cols:
            date: 
                field: date
            type: 
                field: type
            amount: 
                label: Total TTC
                value: 
                    callback: displayTotalAmount
            ticket: 
                field: ticket_validated
                value:
                    callback: checkValidateTickets
            status: 
                field: status