abstract: 1

positions: 1
position_insert: after
common_fields: 0

parent_id_property: id_obj

objects:    
    dol_line: 
        relation: hasOne
        delete: 0
        instance: 
            bimp_object: 
                module: bimpcommercial
                name: DolLine
            id_object: 
                field_value: id_line
                
    product: 
        instance: 
            id_object: 
                field_value: unset
                prop: id_product

    fournisseur_price: 
        extends: fourn_price
        relation: none
        instance: 
            id_object: unset
                
    equipment_lines: 
        relation: hasMany
        delete: 0
        instance: 
            bimp_object:
                module: bimpcommercial
                name: ObjectLineEquipment
                
    remises: 
        relation: hasMany
        delete: 0
        instance: 
            bimp_object:
                module: bimpcommercial
                name: ObjectLineRemise
                
    equipment: 
        relation: none
        delete: 0
        instance: 
            bimp_object: 
                module: bimpequipment
                name: Equipment
            id_object: unset
            
fields: 
    id_obj: 
        label: Objet parent
        type: id_parent
        required: 1
        
    id_line: 
        label: Ligne
        viewable: 0
        filterable: 0
        type: id
        
    id_parent_line:
        label: Ligne parente
        type: id
        default_value: 0
        viewable: 0
        filterable: 0
        input: 
            type: hidden
            
    type: 
        label: Type
        type: int
        values: 
            array: types
        viewable: 0
        required: 1
        
    deletable: 
        label: Supprimable
        type: bool
        viewable: 0
        filterable: 0
        default_value: 1
        
    editable: 
        label: Editable
        type: bool
        viewable: 0
        filterable: 0
        default_value: 1
        
    remisable: 
        label: Remisable
        type: bool
        viewable: 0
        filterable: 0
        filterable: 0
        default_value: 1
        
    force_qty_1: 
        label: Forcer qté à 1
        type: bool
        user_edit: 1
        default_value: 0
        display_if: 
            field_name: type
            show_values: 1
        show: 
            callback: isArticleLine
        
    linked_id_object: 
        label: Objet lié
        
    linked_object_name:
        label: Type d\'objet lié
        
    remise: 
        label: Remise (%)
        type: percent
        default_value: 0
        decimals: 8
        displays: 
            default: 
                label: Par défaut
                type: callback
                method: displayLineData
                params:
                    - remise
        
    remise_pa: 
        label: Remise sur le prix d'achat HT
        type: money
        default_value: 0
        decimals: 8
        show: 
            callback: isArticleLine
        
    remise_crt: 
        label: Remise CRT 
        type: bool
        default_value: 0
        user_edit: 1
        show: 
            callback: isArticleLine
        
    remise_crt_percent: 
        label: Pourcentage remise CRT
        type: percent
        default_value: 0
        user_edit: 1
        show: 
            callback: isArticleLine
        
    hide_product_label: 
        label: Ne pas afficher l'intitulé du produit
        type: bool
        user_edit: 1
        default_value: 0
        display_if: 
            field_name: type
            show_values: 1
            
    hide_in_pdf: 
        label: Masquer la ligne dans le PDF
        type: bool
        user_edit: 1
        input: 
            type: custom
            content: 
                callback: 
                    method: renderLineInput
                    params: 
                        - hide_in_pdf
        default_value: 0
        depends_on: pu_ht,qty,type

forms: 
    default: 
        values: 
            objects: 
                remises: 
                    callback: getClientDefaultRemiseFormValues
        rows: 
            id_parent_line: 
                field: id_parent_line
            type: 
                field: type
                show: 
                    callback: isNotLoaded
            type_edit: 
                custom: 1
                show: 
                    callback: isLoaded
                hidden: 1
                input: 
                    type: hidden
                input_name: type
                data_type: 1
                value: 
                    field_value: type
            product: 
                custom: 1
                label: Produit
                value: 
                    callback: getIdProductFromPost
                input_name: id_product
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - id_product
                display_if: 
                    field_name: type
                    hide_values: 2,3,4
                show:
                    callback: isProductEditable
            pu_ht: 
                custom: 1
                label: Prix unitaire HT
                value: 
                    prop: pu_ht
                input_name: pu_ht
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - pu_ht
                display_if: 
                    field_name: type
                    show_values: 1,3
                depends_on: id_product
            tva_tx: 
                custom: 1
                label: Taux de TVA
                value: 
                    prop: tva_tx
                input_name: tva_tx
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - tva_tx
                display_if: 
                    field_name: type
                    show_values: 1,3
                depends_on: id_product
            qty:
                custom: 1
                label: Quantité
                value: 
                    prop: qty
                input_name: qty 
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - qty
                display_if: 
                    field_name: type
                    show_values: 1,3
                depends_on: id_product
            hide_in_pdf: 
                field: hide_in_pdf
            pa_ht: 
                custom: 1
                label: Prix d'achat
                input_name: pa_ht
                data_type: money
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - pa_ht
                display_if: 
                    field_name: type
                    show_values: 1,3
                depends_on: id_product
            limited: 
                custom: 1
                label: Durée limitée
                input_name: limited
                data_type: bool
                content: 
                    callback: renderLimitedInput
                display_if: 
                    field_name: type
                    show_values: 1,3
                depends_on: id_product
            date_from: 
                custom: 1
                label: Du
                input_name: date_from
                data_type: date
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - date_from
                display_if: 
                    fields_names: type,limited
                    type: 
                        show_values: 1,3
                    limited: 
                        hide_values: 0
            date_to: 
                custom: 1
                label: Au
                input_name: date_to
                data_type: date
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - date_to
                display_if: 
                    fields_names: type,limited
                    type: 
                        show_values: 1,3
                    limited: 
                        hide_values: 0
            margins: 
                custom: 1
                label: Marges
                input_name: margins_table
                content: 
                    callback: renderFormMargins
                show: 
                    callback: showMarginsInForms
                display_if: 
                    field_name: type
                    hide_values: 2,4
            desc: 
                custom: 1
                label: Description
                value: 
                    prop: desc
                input_name: desc
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - desc
                depends_on: id_product
            hide_product_label: 
                field: hide_product_label
            force_qty_1: 
                field: force_qty_1
            remisable: 
                custom: 1
                label: Remises autorisées
                input_name: remisable
                content: 
                    callback: 
                        method: renderLineInput
                        params:
                            - remisable
                depends_on: id_product,qty
                display_if: 
                    field_name: type
                    show_values: 1,3
            remise_crt: 
                custom: 1
                label: Remise CRT
                input_name: remise_crt
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - remise_crt
                depends_on: id_product
                display_if: 
                    field_name: type
                    show_values: 1
            remise_crt_percent:
                custom: 1
                label: Pourcentage remise CRT
                input_name: remise_crt_percent
                data_type: percent
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - remise_crt_percent
                depends_on: id_product,remise_crt
                display_if: 
                    fields_names: remise_crt,type
                    remise_crt: 
                        show_values: 1
                    type: 
                        hide_values: 2,4
            remises: 
                object: remises
                multiple: 1
                form_values: 
                    fields: 
                        object_type: 
                            callback: getParentCommType
                display_if: 
                    fields_names: type,remisable
                    type: 
                        show_values: 1,3
                    remisable: 
                        hide_values: 0
                          
    equipment:
        title: Attribuer un équipement
        rows: 
            - custom: 1
              hidden: 1
              label: Ligne d'équipement
              data_type: int
              input_name: id_line_equipment
              input: 
                  type: hidden
            - custom: 1
              label: Equipement
              input_name: id_equipment
              data_type: id_object
              object: equipment
              create_form: light_place
              create_form_values: 
                  fields: 
                      id_product: 
                          prop: id_product
                  objects: 
                      places: 
                          callback: getNewEquipmentDefaultPlaceValues
              input: 
                  type: search_list
                  search_list:
                      table: be_equipment e
                      field_return_value: e.id
                      field_return_label: e.serial
                      fields_search: e.serial,e.id,e.product_label
                  help: Numéro de série ou ID d'un équipement
                  
    line_forced: 
        extends: default
        force_edit: 1
        rows: 
            product: 
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - id_product
                            - 0
                            - ''
                            - 1            
            pu_ht: 
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - pu_ht
                            - 0
                            - ''
                            - 1
            tva_tx:
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - tva_tx
                            - 0
                            - ''
                            - 1
            qty:
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - qty
                            - 0
                            - ''
                            - 1
#            fourn_price:
#                content: 
#                    callback: 
#                        method: renderLineInput
#                        params: 
#                            - id_fourn_price
#                            - 0
#                            - ''
#                            - 1
            desc:
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - desc
                            - 0
                            - ''
                            - 1
            pa_ht: 
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - pa_ht
                            - 0
                            - ''
                            - 1
            remise_crt:
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - remise_crt
                            - 0
                            - ''
                            - 1
            remise_crt_percent: 
                content: 
                    callback: 
                        method: renderLineInput
                        params: 
                            - remise_crt_percent
                            - 0
                            - ''
                            - 1
            remisable: 
                content: 
                    callback: 
                        method: renderLineInput
                        params:
                            - remisable
                            - 0
                            - ''
                            - 1

filters: 
    id_commercial: 
        label: Commercial
        data_type: id_object
        type: user
        input: 
            type: search_user
            include_empty: 1
            empty_label: Aucun
    ref-prod:
        field: ref-prod
        label: Réf. produit
        type: value_part
    fk_product_type:
        label: Type (produit / service)
        type: check_list
        items: 
            0: Produit
            1: Service
    categorie:
        label: Catégorie produit
        field: categorie
        type: value
        input: 
            type: select
            options: 
                callback: 
                    method: getProductsTagsByTypeArray
                    params: 
                        - categorie
    collection:
        label: Collection produit
        field: collection
        type: value
        input: 
            type: select
            options: 
                callback: 
                    method: getProductsTagsByTypeArray
                    params: 
                        - collection
    nature:
        label: Nature produit
        field: nature
        type: value
        input: 
            type: select
            options: 
                callback: 
                    method: getProductsTagsByTypeArray
                    params: 
                        - nature
    famille:
        label: Famille produit
        field: famille
        type: value
        input: 
            type: select
            options: 
                callback: 
                    method: getProductsTagsByTypeArray
                    params: 
                        - famille
    gamme:
        label: Gamme produit
        field: gamme
        type: value
        input: 
            type: select
            options: 
                callback: 
                    method: getProductsTagsByTypeArray
                    params: 
                        - gamme
    acomptes: 
        field: acomptes
        label: Lignes d'acompte / avoir
        type: check_list
        items: 
            1: OUI
            0: NON        
            
filters_panels: 
    default: 
        filters: 
            parent:ref:
                label: Ref. Pièce
            parent:fk_soc:
            parent:entrepot:
            id_commercial: 
            dol_line:fk_product:
            ref-prod:
            fk_product_type:
            parent:ef_type:
            dol_line:description: 
            dol_line:total_ht: 
            dol_line:total_ttc:
            
lists_cols: 
    position: 
        label: N°
        min_width: 40;
    desc:
        label: Description
        info: Version longue
        value: 
            callback: 
                method: displayLineData
                params:
                    - desc
        max_width: 460px
#        min_width: 280px
    desc_light: 
        extends: desc
        info: Version courte
        value: 
            callback: 
                params:
                    - desc_light
    pu_ht: 
        label: PU HT
        value: 
            callback:
                method: displayLineData
                params:
                    - pu_ht
                    - 1
    pu_ht_remise: 
        label: PU HT Remisé
        value: 
            callback: displayUnitPriceHTWithRemises
    tva:
        label: TVA
        value: 
            callback:
                method: displayLineData
                params:
                    - tva_tx
        max_width: 45px
        min_width: 45px
    pa_ht: 
        label: PA HT
        value: 
            callback:
                method: displayLineData
                params:
                    - pa_ht
    qty: 
        label: Qté
        value: 
            callback: 
                method: displayLineData
                params:
                    - qty
                    - 1
    remise_full: 
        label: Remises <br/>HT / TTC (%)
        value: 
            callback: displayRemise
        min_width: 130
    force_qty_1:
        field: force_qty_1
        edit: 1
    total_ht: 
        label: Total HT (Hors remises)
        value: 
            callback: 
                method: displayLineData
                params:
                    - total_ht
    total_ht_w_remises: 
        label: Total HT (Avec remises)
        value: 
            callback: 
                method: displayLineData
                params:
                    - total_ht_w_remises
    total_ttc: 
        label: Total TTC
        value: 
            callback:
                method: displayLineData
                params:
                    - total_ttc
    margin: 
        label:
            callback: getMarginLabel
        value: 
            callback: 
                method: displayLineData
                params:
                    - margin        
    marge_prevue: 
        label: Marge finale prévue
        value: 
            callback: 
                method: displayLineData
                params:
                    - marge_prevue      
    remise_crt: 
        label: Rem. CRT
        edit: 1
        min_width: 50
    remise_pa: 
        label: Remise PA
    product:zone_pr: 
        label: Emplacement Lyon
    sn:
        label: S/N
        value:
            callback: displaySerials
    linked_object:
        label: Objet lié
        value:
            callback: displayLinkedObject
                        
lists:      
    global:
        objects_change_reload: ObjectLineRemise,RemiseGlobale
        configurable: 1
        positions: 0
        list_filters: 
             - name: type
               filter: 
                   in: 
                       - 1
                       - 3
        filters_panel: default
        filters_panel_open: 1
        sort_field: id_line
        sort_way: desc
        pagination: 1
        n: 10
        cols:
            id_obj:
            parent:fk_soc:
            desc:
            pu_ht: 
            tva:
            qty:
            remise_full:
            total_ttc: 
            pa_ht: 
            remise_crt:
            margin:
                
    product: 
        extends: global
        filters_panel_open: 0
                
    default: 
        configurable: 1
        checkboxes: 1
        positions: 1
        positions_open: 1
        objects_change_reload: ObjectLineRemise,RemiseGlobale
        after_list_callback: renderQuickAddForm
        refresh_after_content: 0
        enable_search: 1
        enable_sort: 1
        pagination: 0
        bulk_actions:
            - label: supprimer les lignes sélectionnées
              icon: fas_trash-alt
              onclick: deleteSelectedObjects('list_id', $(this))
        sort_field: position
        sort_way: asc
        n: 0
        single_cell:
            filters:
                type: 2
            col: desc
#        add_btn: 
#            callback: isParentEditable
        add_form_name: default
        add_btn_label: Ajouter une ligne
        edit_btn: 1
        delete_btn: 1
        item_checkbox: 
            callback: isDeletable
        extra_btn: 
            callback: getListExtraBtn
        header_buttons:
            callback: 
                method: getLinesListHeaderExtraBtn
                object: 
                    callback: getParentInstance
        td_style: 
            callback: getRowStyle
        cols:    
            desc:
            pu_ht: 
            tva:
            qty:
            remise_full:
            total_ttc: 
            pa_ht: 
            remise_crt:
            margin:

stats_lists_cols: 
    dolline_product: 
        field: fk_product
        child: dol_line
    pu:
        field: subprice
        child: dol_line
        type: avg
        data_type: money
        decimals: 2
    soc:
        field: fk_soc
        child: parent
#        data_type: id_object
#        type: societe
#        display: nom_url
#    collection:
#        field: collection
#        child: product
                    
stats_lists: 
    default: 
        n: 10
        configurable: 1
        filters_panel: default
        group_by_options: 
            - type
            - jj:
              field: fk_product
              child: dol_line
        cols: 
            dolline_product:
            pu:
            soc:
            collection:
